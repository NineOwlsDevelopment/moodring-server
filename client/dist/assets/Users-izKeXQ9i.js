import{r,b9 as U,t as i,j as e,ba as w,h as A,bb as D,bc as _}from"./index-Um2jvS2c.js";const F=1e6,P=()=>{const[m,N]=r.useState([]),[n,o]=r.useState({page:1,limit:20,total:0,totalPages:0,hasMore:!1}),[v,u]=r.useState(!0),[c,p]=r.useState(""),[h,b]=r.useState(null),[a,d]=r.useState({userId:null,amount:"",token:"USDC",reason:""}),[j,g]=r.useState(null);r.useEffect(()=>{x()},[n.page,c]);const x=async()=>{var t,s;try{u(!0);const l=await U({page:n.page,limit:n.limit,search:c||void 0});N(l.users),o(l.pagination)}catch(l){console.error("Failed to load users:",l),i.error(((s=(t=l.response)==null?void 0:t.data)==null?void 0:s.error)||"Failed to load users")}finally{u(!1)}},S=t=>{t.preventDefault(),o(s=>({...s,page:1})),x()},C=async()=>{var t,s;if(!a.userId||!a.amount){i.error("Please fill in all required fields");return}try{b(a.userId);let l=Number(a.amount);a.token==="USDC"&&(l=Math.round(l*F)),await _(a.userId,{amount:l,token_symbol:a.token,reason:a.reason||"Manual adjustment"}),i.success("Balance adjusted successfully"),d({userId:null,amount:"",token:"USDC",reason:""}),x()}catch(l){console.error("Failed to adjust balance:",l),i.error(((s=(t=l.response)==null?void 0:t.data)==null?void 0:s.error)||"Failed to adjust balance")}finally{b(null)}},k=async(t,s)=>{var l,y;try{g(t),await D(t,!s),i.success(s?"Admin privileges removed":"User granted admin privileges"),x()}catch(f){console.error("Failed to toggle admin:",f),i.error(((y=(l=f.response)==null?void 0:l.data)==null?void 0:y.error)||"Failed to update admin status")}finally{g(null)}};return e.jsxs("div",{className:"p-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:"Manage Users"}),e.jsxs("div",{className:"text-sm text-gray-400",children:["Total: ",n.total.toLocaleString()," users"]})]}),e.jsx("div",{className:"card mb-6",children:e.jsxs("form",{onSubmit:S,className:"flex gap-4",children:[e.jsx("input",{type:"text",placeholder:"Search by username or email...",value:c,onChange:t=>p(t.target.value),className:"input flex-1"}),e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Search"}),c&&e.jsx("button",{type:"button",onClick:()=>{p(""),o(t=>({...t,page:1}))},className:"btn btn-secondary",children:"Clear"})]})}),e.jsx("div",{className:"card",children:v?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-primary-500"})}):m.length===0?e.jsx("div",{className:"text-center py-12 text-gray-400",children:"No users found"}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-dark-700",children:[e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-300",children:"User"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-300",children:"Email"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-300",children:"Wallet"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-300",children:"USDC Balance"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-300",children:"SOL Balance"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-300",children:"Created"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-300",children:"Admin"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-300",children:"Actions"})]})}),e.jsx("tbody",{children:m.map(t=>e.jsxs("tr",{className:"border-b border-dark-700 hover:bg-dark-800 transition-colors",children:[e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-white font-medium",children:t.display_name||t.username}),e.jsxs("div",{className:"text-xs text-gray-400",children:["@",t.username]})]})}),e.jsx("td",{className:"py-3 px-4 text-gray-300 text-sm",children:t.email}),e.jsx("td",{className:"py-3 px-4",children:t.wallet_public_key?e.jsx("span",{className:"font-mono text-xs text-gray-400",children:w(t.wallet_public_key,6)}):e.jsx("span",{className:"text-gray-500 text-xs",children:"No wallet"})}),e.jsx("td",{className:"py-3 px-4 text-gray-300",children:A(t.balance_usdc)}),e.jsxs("td",{className:"py-3 px-4 text-gray-300",children:[(t.balance_sol/1e9).toFixed(4)," SOL"]}),e.jsx("td",{className:"py-3 px-4 text-gray-400 text-sm",children:new Date(typeof t.created_at=="string"&&t.created_at.includes(" ")?t.created_at.replace(" ","T"):t.created_at).toLocaleDateString()}),e.jsx("td",{className:"py-3 px-4",children:t.is_admin?e.jsx("span",{className:"px-2 py-1 bg-purple-500/20 text-purple-300 border border-purple-500/30 rounded-full text-xs font-medium",children:"Admin"}):e.jsx("span",{className:"text-gray-500 text-xs",children:"User"})}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>k(t.id,t.is_admin||!1),disabled:j===t.id,className:`text-sm font-medium ${t.is_admin?"text-yellow-400 hover:text-yellow-300":"text-purple-400 hover:text-purple-300"} disabled:opacity-50`,children:j===t.id?"Updating...":t.is_admin?"Remove Admin":"Make Admin"}),e.jsx("button",{onClick:()=>d({userId:t.id,amount:"",token:"USDC",reason:""}),className:"text-primary-400 hover:text-primary-300 text-sm font-medium",children:"Adjust Balance"})]})})]},t.id))})]})}),n.totalPages>1&&e.jsxs("div",{className:"flex items-center justify-between mt-6 pt-6 border-t border-dark-700",children:[e.jsxs("div",{className:"text-sm text-gray-400",children:["Page ",n.page," of ",n.totalPages]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>o(t=>({...t,page:Math.max(1,t.page-1)})),disabled:n.page===1,className:"btn btn-secondary text-sm disabled:opacity-50 disabled:cursor-not-allowed",children:"Previous"}),e.jsx("button",{onClick:()=>o(t=>({...t,page:Math.min(t.totalPages,t.page+1)})),disabled:!n.hasMore,className:"btn btn-secondary text-sm disabled:opacity-50 disabled:cursor-not-allowed",children:"Next"})]})]})]})}),a.userId&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"card max-w-md w-full",children:[e.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"Adjust User Balance"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Token"}),e.jsxs("select",{value:a.token,onChange:t=>d(s=>({...s,token:t.target.value})),className:"input w-full",children:[e.jsx("option",{value:"USDC",children:"USDC"}),e.jsx("option",{value:"SOL",children:"SOL"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Amount (use negative for deduction)"}),e.jsx("input",{type:"number",step:a.token==="USDC"?"0.01":"0.000001",value:a.amount,onChange:t=>d(s=>({...s,amount:t.target.value})),placeholder:a.token==="USDC"?"Amount in USDC (e.g., 1000)":"Amount in SOL",className:"input w-full"}),a.token==="USDC"&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Enter amount in regular USDC (will be converted to micro-USDC)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Reason (optional)"}),e.jsx("input",{type:"text",value:a.reason,onChange:t=>d(s=>({...s,reason:t.target.value})),placeholder:"Reason for adjustment",className:"input w-full"})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:()=>d({userId:null,amount:"",token:"USDC",reason:""}),className:"btn btn-secondary flex-1",children:"Cancel"}),e.jsx("button",{onClick:C,disabled:h===a.userId,className:"btn btn-primary flex-1",children:h===a.userId?"Processing...":"Adjust"})]})]})})]})};export{P as AdminUsers};
