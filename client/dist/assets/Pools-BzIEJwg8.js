import{d as K,r as a,_ as me,j as e,h as p,b as q,aE as he,t as $,aF as xe,a7 as be,v as te,ah as pe,L as ge,f as fe}from"./index-KlQHYXDb.js";import{s as ve}from"./categorySort-BEAn0rC4.js";const ye=({marketId:m,onAdded:P,compact:g=!1})=>{const{user:f}=K(),[b,h]=a.useState(!1),[i,d]=a.useState(""),[n,R]=a.useState(null),[j,F]=a.useState(!1),M=async()=>{if(f){F(!0);try{const l=(await q.get(`/market/${m}`)).data.market;R({shared_pool_liquidity:Number(l.shared_pool_liquidity||0),total_shared_lp_shares:Number(l.total_shared_lp_shares||0),accumulated_lp_fees:Number(l.accumulated_lp_fees||0),is_resolved:l.is_resolved||!1})}catch(o){console.error("Failed to load liquidity info:",o)}finally{F(!1)}}};a.useEffect(()=>{M()},[f,m]),me(m,{onMarket:o=>{o.event==="updated"&&o.data&&o.data.shared_pool_liquidity!==void 0&&R(l=>l&&{...l,shared_pool_liquidity:Number(o.data.shared_pool_liquidity),total_shared_lp_shares:Number(o.data.total_shared_lp_shares||l.total_shared_lp_shares),accumulated_lp_fees:Number(o.data.accumulated_lp_fees||l.accumulated_lp_fees)})}});const _=a.useMemo(()=>{if(!i||!n)return null;const o=parseFloat(i);if(isNaN(o)||o<=0)return null;const l=Math.floor(o*1e6),y=n.shared_pool_liquidity,x=n.total_shared_lp_shares;return x===0||y===0?(console.log("pool is empty, returning amountInMicroUSDC",l),l):Math.floor(l*x/y)},[i,n]),L=async()=>{var o,l;if(!(!f||!i||parseFloat(i)<=0)){h(!0);try{const y=await he({market:m,amount:parseFloat(i)});$.success(`Successfully added ${p(y.amount_deposited)} liquidity! You received ${p(y.shares_minted)} LP shares.`),d(""),P&&P()}catch(y){$.error(((l=(o=y.response)==null?void 0:o.data)==null?void 0:l.error)||"Failed to add liquidity. Please try again.")}finally{h(!1)}}};return f?g?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-moon-grey-dark mb-1.5",children:"Amount (USDC)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",step:"0.01",min:"0.01",value:i,onChange:o=>d(o.target.value),placeholder:"0.00",className:"w-full px-4 py-3 pr-16 bg-white/[0.03] border border-white/[0.08] rounded-xl text-white text-lg font-medium tabular-nums placeholder-moon-grey-dark focus:border-neon-iris/50 focus:ring-1 focus:ring-neon-iris/25 transition-all [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none",disabled:b}),e.jsxs("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 flex flex-col border border-white/[0.08] rounded-md overflow-hidden bg-white/[0.03] backdrop-blur-sm",children:[e.jsx("button",{type:"button",onClick:()=>{const o=parseFloat(i)||0,l=Math.max(.01,o+1);d(String(l.toFixed(2)))},disabled:b,className:"w-7 h-6 flex items-center justify-center bg-white/[0.05] hover:bg-neon-iris/20 hover:border-neon-iris/50 text-moon-grey-dark hover:text-neon-iris-light active:bg-neon-iris/30 transition-all duration-200 border-b border-white/[0.08] disabled:opacity-40 disabled:cursor-not-allowed disabled:hover:bg-white/[0.05] disabled:hover:text-moon-grey-dark group","aria-label":"Increment",children:e.jsx("svg",{className:"w-3.5 h-3.5 group-hover:scale-110 transition-transform",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M5 15l7-7 7 7"})})}),e.jsx("button",{type:"button",onClick:()=>{const o=parseFloat(i)||0,l=Math.max(.01,o-1);d(String(l.toFixed(2)))},disabled:b,className:"w-7 h-6 flex items-center justify-center bg-white/[0.05] hover:bg-neon-iris/20 hover:border-neon-iris/50 text-moon-grey-dark hover:text-neon-iris-light active:bg-neon-iris/30 transition-all duration-200 disabled:opacity-40 disabled:cursor-not-allowed disabled:hover:bg-white/[0.05] disabled:hover:text-moon-grey-dark group","aria-label":"Decrement",children:e.jsx("svg",{className:"w-3.5 h-3.5 group-hover:scale-110 transition-transform",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M19 9l-7 7-7-7"})})})]})]})]}),n&&e.jsxs("div",{className:"text-[10px] text-moon-grey-dark space-y-0.5",children:[e.jsxs("div",{children:["Pool: ",p(n.shared_pool_liquidity)]}),_!==null&&i&&parseFloat(i)>0&&e.jsxs("div",{className:"text-aqua-pulse/80",children:["You will receive: ",p(_).replace("$","")," ","LP shares"]})]}),e.jsx("button",{onClick:L,disabled:b||!i||parseFloat(i)<=0,className:"w-full py-2.5 rounded-xl font-semibold text-sm transition-all disabled:opacity-50 disabled:cursor-not-allowed bg-neon-iris hover:bg-neon-iris/90 text-white shadow-lg shadow-neon-iris/25",children:b?"Adding...":"Add Liquidity"}),!(n!=null&&n.is_resolved)&&e.jsx("div",{className:"bg-amber-500/10 border border-amber-500/30 rounded-lg p-2.5",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("svg",{className:"w-4 h-4 text-amber-400 flex-shrink-0 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsxs("p",{className:"text-[10px] text-amber-400/90 leading-relaxed",children:[e.jsx("span",{className:"font-semibold",children:"Funds will be locked"})," ","until the market is resolved. You can only withdraw your proportional share of available liquidity after resolution."]})]})})]}):e.jsxs("div",{className:"px-4 py-3 bg-neon-iris/10 rounded-lg border border-neon-iris/20",children:[e.jsx("h4",{className:"text-sm font-medium text-white mb-3",children:"Add Liquidity"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-moon-grey-dark mb-1.5",children:"Amount (USDC)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",step:"0.01",min:"0.01",value:i,onChange:o=>d(o.target.value),placeholder:"0.00",className:"w-full px-4 py-3 pr-16 bg-white/[0.03] border border-white/[0.08] rounded-xl text-white text-lg font-medium tabular-nums placeholder-moon-grey-dark focus:border-neon-iris/50 focus:ring-1 focus:ring-neon-iris/25 transition-all [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none",disabled:b}),e.jsxs("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 flex flex-col border border-white/[0.08] rounded-md overflow-hidden bg-white/[0.03] backdrop-blur-sm",children:[e.jsx("button",{type:"button",onClick:()=>{const o=parseFloat(i)||0,l=Math.max(.01,o+1);d(String(l.toFixed(2)))},disabled:b,className:"w-7 h-6 flex items-center justify-center bg-white/[0.05] hover:bg-neon-iris/20 hover:border-neon-iris/50 text-moon-grey-dark hover:text-neon-iris-light active:bg-neon-iris/30 transition-all duration-200 border-b border-white/[0.08] disabled:opacity-40 disabled:cursor-not-allowed disabled:hover:bg-white/[0.05] disabled:hover:text-moon-grey-dark group","aria-label":"Increment",children:e.jsx("svg",{className:"w-3.5 h-3.5 group-hover:scale-110 transition-transform",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M5 15l7-7 7 7"})})}),e.jsx("button",{type:"button",onClick:()=>{const o=parseFloat(i)||0,l=Math.max(.01,o-1);d(String(l.toFixed(2)))},disabled:b,className:"w-7 h-6 flex items-center justify-center bg-white/[0.05] hover:bg-neon-iris/20 hover:border-neon-iris/50 text-moon-grey-dark hover:text-neon-iris-light active:bg-neon-iris/30 transition-all duration-200 disabled:opacity-40 disabled:cursor-not-allowed disabled:hover:bg-white/[0.05] disabled:hover:text-moon-grey-dark group","aria-label":"Decrement",children:e.jsx("svg",{className:"w-3.5 h-3.5 group-hover:scale-110 transition-transform",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M19 9l-7 7-7-7"})})})]})]})]}),n&&e.jsxs("div",{className:"text-xs text-moon-grey space-y-1",children:[e.jsxs("div",{children:["Current Pool: ",p(n.shared_pool_liquidity)]}),n.accumulated_lp_fees>0&&e.jsxs("div",{children:["Fees Earned: ",p(n.accumulated_lp_fees)]}),_!==null&&i&&parseFloat(i)>0&&e.jsxs("div",{className:"text-aqua-pulse/80 font-medium pt-1 border-t border-white/5",children:["You will receive: ",p(_).replace("$","")," ","LP shares"]})]}),e.jsx("button",{onClick:L,disabled:b||!i||parseFloat(i)<=0,className:"w-full py-2.5 rounded-xl font-semibold text-sm transition-all disabled:opacity-50 disabled:cursor-not-allowed bg-neon-iris hover:bg-neon-iris/90 text-white shadow-lg shadow-neon-iris/25",children:b?"Adding...":"Add Liquidity"}),e.jsx("p",{className:"text-[10px] text-moon-grey-dark",children:"Earn fees from trading activity. LP shares represent your share of the liquidity pool."}),!(n!=null&&n.is_resolved)&&e.jsx("div",{className:"bg-amber-500/10 border border-amber-500/30 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("svg",{className:"w-4 h-4 text-amber-400 flex-shrink-0 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs text-amber-400/90 font-semibold mb-1",children:"Funds Will Be Locked"}),e.jsx("p",{className:"text-[10px] text-amber-400/80 leading-relaxed",children:"Your liquidity will be locked until the market is resolved. After resolution, you can withdraw your proportional share of available liquidity (total liquidity minus outstanding shares redeemable)."})]})]})})]})]}):null},we=({marketId:m,onRemoved:P})=>{const{user:g}=K(),[f,b]=a.useState(!1),[h,i]=a.useState(""),[d,n]=a.useState(null),[R,j]=a.useState(!1),[F,M]=a.useState(!1);a.useEffect(()=>{(async()=>{if(g){j(!0);try{const v=(await q.get(`/liquidity/position/${m}`)).data.position,A=(await q.get(`/market/${m}`)).data.market;M((A==null?void 0:A.is_resolved)||!1),v&&Number(v.shares)>0?n({shares:Number(v.shares),deposited_amount:Number(v.deposited_amount),current_value:Number(v.current_value),claimable_value:Number(v.claimable_value||0)}):n(null)}catch(u){console.error("Failed to load LP position:",u),n(null)}finally{j(!1)}}})()},[g,m]);const _=async()=>{var u,v;if(!g||!d||!h||parseFloat(h)<=0)return;const x=parseFloat(h)*1e6;if(x>d.shares){$.error("Cannot remove more shares than you have");return}b(!0);try{const w=await xe({market:m,shares:x});$.success(`Successfully removed liquidity! You received ${p(w.usdc_returned)} and ${p(w.fees_earned)} in fees.`),i(""),await L(),P&&P()}catch(w){$.error(((v=(u=w.response)==null?void 0:u.data)==null?void 0:v.error)||"Failed to remove liquidity. Please try again.")}finally{b(!1)}},L=async()=>{if(g)try{const u=(await q.get(`/liquidity/position/${m}`)).data.position,w=(await q.get(`/market/${m}`)).data.market;M((w==null?void 0:w.is_resolved)||!1),u&&Number(u.shares)>0?n({shares:Number(u.shares),deposited_amount:Number(u.deposited_amount),current_value:Number(u.current_value),claimable_value:Number(u.claimable_value||0)}):n(null)}catch(x){console.error("Failed to load LP position:",x),n(null)}};if(!g)return null;if(R)return e.jsx("div",{className:"py-2 text-sm text-gray-400",children:"Loading LP position..."});if(!d||d.shares<=0)return e.jsx("div",{className:"text-sm text-moon-grey-dark",children:"You don't have any liquidity in this pool"});const o=d.shares/1e6,l=d.claimable_value??d.current_value,y=h?parseFloat(h)/o*l:0;return F?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-moon-grey-dark mb-1.5",children:"LP Shares to Remove"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",step:"0.01",min:"0.01",max:o,value:h,onChange:x=>i(x.target.value),placeholder:"0.00",className:"w-full px-4 py-3 pr-16 bg-white/[0.03] border border-white/[0.08] rounded-xl text-white text-lg font-medium tabular-nums placeholder-moon-grey-dark focus:border-neon-iris/50 focus:ring-1 focus:ring-neon-iris/25 transition-all [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none",disabled:f}),e.jsxs("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 flex flex-col border border-white/[0.08] rounded-md overflow-hidden bg-white/[0.03] backdrop-blur-sm",children:[e.jsx("button",{type:"button",onClick:()=>{const x=parseFloat(h)||0,u=Math.min(o,Math.max(.01,x+1));i(String(u.toFixed(2)))},disabled:f,className:"w-7 h-6 flex items-center justify-center bg-white/[0.05] hover:bg-neon-iris/20 hover:border-neon-iris/50 text-moon-grey-dark hover:text-neon-iris-light active:bg-neon-iris/30 transition-all duration-200 border-b border-white/[0.08] disabled:opacity-40 disabled:cursor-not-allowed disabled:hover:bg-white/[0.05] disabled:hover:text-moon-grey-dark group","aria-label":"Increment",children:e.jsx("svg",{className:"w-3.5 h-3.5 group-hover:scale-110 transition-transform",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M5 15l7-7 7 7"})})}),e.jsx("button",{type:"button",onClick:()=>{const x=parseFloat(h)||0,u=Math.max(.01,x-1);i(String(u.toFixed(2)))},disabled:f,className:"w-7 h-6 flex items-center justify-center bg-white/[0.05] hover:bg-neon-iris/20 hover:border-neon-iris/50 text-moon-grey-dark hover:text-neon-iris-light active:bg-neon-iris/30 transition-all duration-200 disabled:opacity-40 disabled:cursor-not-allowed disabled:hover:bg-white/[0.05] disabled:hover:text-moon-grey-dark group","aria-label":"Decrement",children:e.jsx("svg",{className:"w-3.5 h-3.5 group-hover:scale-110 transition-transform",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M19 9l-7 7-7-7"})})})]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[e.jsxs("span",{className:"text-xs text-moon-grey-dark",children:["Max: ",p(d.shares)," LP"]}),e.jsx("button",{onClick:()=>i(o.toString()),className:"text-xs text-neon-iris hover:text-neon-iris/80 transition-colors",children:"Max"})]})]}),h&&parseFloat(h)>0&&e.jsxs("div",{className:"bg-white/5 rounded-lg p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-moon-grey-dark",children:"You'll Receive"}),e.jsx("span",{className:"text-white font-semibold tabular-nums",children:p(y)})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-moon-grey-dark",children:[e.jsx("span",{children:"From Available Liquidity"}),e.jsxs("span",{className:"text-moon-grey",children:[p(l)," available"]})]})]}),e.jsxs("div",{className:"text-xs text-moon-grey-dark space-y-1",children:[e.jsxs("div",{children:["Your Position: ",p(d.current_value)," (",p(d.shares)," LP)"]}),d.claimable_value!==void 0&&d.claimable_value<d.current_value&&e.jsxs("div",{className:"text-amber-400",children:["Note: Only ",p(l)," is available for withdrawal. The remaining liquidity is reserved for outstanding shares redeemable."]})]}),e.jsx("button",{onClick:_,disabled:f||!h||parseFloat(h)<=0||parseFloat(h)>o,className:"w-full py-2.5 rounded-xl font-semibold text-sm transition-all disabled:opacity-50 disabled:cursor-not-allowed bg-rose-500 hover:bg-rose-400 text-white shadow-lg shadow-rose-500/25",children:f?"Removing...":"Remove Liquidity"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-amber-500/10 border border-amber-500/30 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("svg",{className:"w-5 h-5 text-amber-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),e.jsx("h3",{className:"text-sm font-semibold text-amber-400",children:"LP Shares Locked"})]}),e.jsx("p",{className:"text-xs text-amber-400/80",children:"Your LP shares are locked until the market is resolved. Once the market resolves, you can withdraw your proportional share of available liquidity (total liquidity minus outstanding shares redeemable)."})]}),e.jsx("div",{className:"text-xs text-moon-grey-dark space-y-1",children:e.jsxs("div",{children:["Your Position: ",p(d.current_value)," (",p(d.shares).replace("$","")," LP)"]})})]})},J=12,ke=()=>{const{user:m}=K(),P=be(),[g,f]=a.useState("all"),[b,h]=a.useState("admin"),[i,d]=a.useState("all"),[n,R]=a.useState("tvl"),[j,F]=a.useState([]),[M,_]=a.useState([]),[L,o]=a.useState([]),[l,y]=a.useState(!0),[x,u]=a.useState(!1),[v,w]=a.useState(!1),[A,O]=a.useState(1),[C,S]=a.useState(null),[se,B]=a.useState(!1),[re,D]=a.useState(!1),[I,Q]=a.useState(!1),[H,ae]=a.useState([{id:"all",label:"All Categories"}]),V=a.useRef(null),E=a.useCallback(t=>{const s=(Number(t.shared_pool_liquidity)||0)/1e6;if(!s||s===0)return 0;const r=(Number(t.accumulated_lp_fees)||0)/1e6,c=(Date.now()-Number(t.created_at)*1e3)/(1e3*60*60*24),N=Math.max(1,c);return r/s*365/N*100},[]),G=a.useCallback(t=>L.find(s=>s.market_id===t),[L]),W=a.useCallback(t=>{let s=[...t];return g==="my-pools"&&(s=s.filter(r=>G(r.id))),i!=="all"&&(s=s.filter(r=>{var c;return((c=r.categories)==null?void 0:c.some(N=>N.name.toLowerCase()===i))||!1})),s},[g,i,G]),Y=a.useCallback(t=>{const s=[...t];return s.sort((r,c)=>{switch(n){case"tvl":{const N=(Number(r.shared_pool_liquidity)||0)/1e6+(Number(r.accumulated_lp_fees)||0)/1e6;return(Number(c.shared_pool_liquidity)||0)/1e6+(Number(c.accumulated_lp_fees)||0)/1e6-N}case"apr":return E(c)-E(r);case"fees":{const N=(Number(r.accumulated_lp_fees)||0)/1e6;return(Number(c.accumulated_lp_fees)||0)/1e6-N}case"newest":return Number(c.created_at)-Number(r.created_at);case"oldest":return Number(r.created_at)-Number(c.created_at);case"volume":return Number(c.total_volume||0)-Number(r.total_volume||0);default:return 0}}),s},[n,E]),U=a.useCallback((t,s)=>{F(r=>r.map(c=>c.id===t?{...c,...s}:c))},[]);a.useEffect(()=>{(async()=>{try{const{categories:s}=await fe(),r=ve(s);ae([{id:"all",label:"All Categories"},...r.map(c=>({id:c.name.toLowerCase(),label:c.name}))])}catch(s){console.error("Failed to load categories:",s)}})()},[]),a.useEffect(()=>{te.connect();const t=r=>{r.event==="updated"&&r.data&&V.current===r.market_id&&(U(r.market_id,{shared_pool_liquidity:Number(r.data.shared_pool_liquidity||0),total_shared_lp_shares:Number(r.data.total_shared_lp_shares||0),accumulated_lp_fees:Number(r.data.accumulated_lp_fees||0)}),m&&z(),V.current=null)},s=te.onMarket(t);return()=>s()},[m,U]),a.useEffect(()=>{const t=W(j),s=Y(t);O(1),_(s.slice(0,J)),w(s.length>J)},[j,W,Y]);const oe=async(t=!0)=>{t?(y(!0),O(1)):u(!0);try{const c=((await q.get("/market",{params:{status:"active",limit:1e3,creator_type:b,category:i!=="all"?i:void 0}})).data.markets||[]).filter(k=>k.is_initialized&&Number(k.shared_pool_liquidity||0)>0&&!k.is_resolved),N=await Promise.all(c.map(async k=>{try{const ee=await q.get(`/liquidity/share-value/${k.id}`);return{...k,lp_count:ee.data.lp_count||0}}catch{return{...k,lp_count:0}}}));F(N)}catch(s){console.error("Failed to load pools:",s),$.error("Failed to load pools")}finally{y(!1),u(!1)}};a.useEffect(()=>{oe(),m?z():g==="my-pools"&&f("all")},[m,b,i,g]);const z=async()=>{try{const t=await pe();o(t.positions)}catch(t){console.error("Failed to load positions:",t)}},ie=a.useCallback(()=>{x||!v||(u(!0),setTimeout(()=>{const t=W(j),s=Y(t),r=A+1,c=s.slice(0,r*J);_(c),O(r),w(c.length<s.length),u(!1)},100))},[j,A,x,v,W,Y]),X=t=>{V.current=t,S(t),B(!0)},le=t=>{V.current=t,S(t),D(!0)},Z=a.useCallback(async t=>{try{const r=(await q.get(`/market/${t}`)).data.market;U(t,{shared_pool_liquidity:Number(r.shared_pool_liquidity||0),total_shared_lp_shares:Number(r.total_shared_lp_shares||0),accumulated_lp_fees:Number(r.accumulated_lp_fees||0)})}catch(s){console.error("Failed to reload pool:",s)}},[U]),ne=async()=>{z(),C&&await Z(C),B(!1),S(null)},de=async()=>{z(),C&&await Z(C),D(!1),S(null)},ce=j.reduce((t,s)=>t+(Number(s.shared_pool_liquidity)||0)/1e6+(Number(s.accumulated_lp_fees)||0)/1e6,0),ue=j.reduce((t,s)=>t+(Number(s.accumulated_lp_fees)||0)/1e6,0),T=t=>{if(t>=1e6){const s=t/1e6,r=Math.round(s*100)/100;return`$${r.toFixed(r%1===0?0:2)}M`}if(t>=1e3){const s=t/1e3,r=Math.round(s*100)/100;return`$${r.toFixed(r%1===0?0:2)}k`}return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(t)};return e.jsxs("div",{className:"max-w-7xl mx-auto px-3 sm:px-6 lg:px-8 py-4 sm:py-6 pb-20 md:pb-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-4",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-white",children:"Pools"}),e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsxs("div",{className:"text-moon-grey-dark",children:[e.jsx("span",{className:"text-moon-grey",children:"TVL: "}),e.jsx("span",{className:"text-white font-semibold tabular-nums",children:T(ce)})]}),e.jsxs("div",{className:"text-moon-grey-dark",children:[e.jsx("span",{className:"text-moon-grey",children:"Fees: "}),e.jsx("span",{className:"text-aqua-pulse font-semibold tabular-nums",children:T(ue)})]}),e.jsx("div",{className:"text-moon-grey-dark",children:e.jsxs("span",{className:"text-moon-grey",children:[j.length," pools"]})})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-1 bg-graphite-deep rounded-lg p-1 border border-graphite-light",children:[e.jsx("button",{onClick:()=>f("all"),className:`px-3 py-1 rounded-md font-medium text-xs transition-all ${g==="all"?"bg-graphite-light text-white":"text-moon-grey hover:text-white"}`,children:"All"}),m&&e.jsxs("button",{onClick:()=>f("my-pools"),className:`px-3 py-1 rounded-md font-medium text-xs transition-all ${g==="my-pools"?"bg-graphite-light text-white":"text-moon-grey hover:text-white"}`,children:["My Pools (",L.length,")"]})]}),e.jsxs("div",{className:"flex items-center gap-1 bg-graphite-deep rounded-lg p-1 border border-graphite-light",children:[e.jsx("button",{onClick:()=>h("admin"),className:`px-3 py-1 rounded-md font-medium text-xs transition-all ${b==="admin"?"bg-neon-iris text-white shadow-md shadow-neon-iris/20":"text-moon-grey hover:text-white"}`,children:"Official"}),e.jsx("button",{onClick:()=>h("user"),className:`px-3 py-1 rounded-md font-medium text-xs transition-all ${b==="user"?"bg-neon-iris text-white shadow-md shadow-neon-iris/20":"text-moon-grey hover:text-white"}`,children:"Community"}),e.jsx("button",{onClick:()=>h("all"),className:`px-3 py-1 rounded-md font-medium text-xs transition-all ${b==="all"?"bg-neon-iris text-white shadow-md shadow-neon-iris/20":"text-moon-grey hover:text-white"}`,children:"All"})]}),e.jsx("select",{value:i,onChange:t=>d(t.target.value),className:"px-3 py-1 rounded-lg font-medium text-xs bg-graphite-light text-white border border-graphite-light hover:bg-graphite-hover transition-all focus:outline-none focus:ring-1 focus:ring-neon-iris/50",children:H.map(t=>e.jsx("option",{value:t.id,children:t.label},t.id))}),e.jsxs("select",{value:n,onChange:t=>R(t.target.value),className:"px-3 py-1 rounded-lg font-medium text-xs bg-graphite-light text-white border border-graphite-light hover:bg-graphite-hover transition-all focus:outline-none focus:ring-1 focus:ring-neon-iris/50",children:[e.jsx("option",{value:"tvl",children:"Sort: TVL ↓"}),e.jsx("option",{value:"apr",children:"Sort: APR ↓"}),e.jsx("option",{value:"fees",children:"Sort: Fees ↓"}),e.jsx("option",{value:"volume",children:"Sort: Volume ↓"}),e.jsx("option",{value:"newest",children:"Sort: Newest"}),e.jsx("option",{value:"oldest",children:"Sort: Oldest"})]}),H.length>8&&e.jsxs("button",{onClick:()=>Q(!I),className:"px-3 py-1 rounded-lg font-medium text-xs bg-graphite-light text-moon-grey hover:text-white border border-graphite-light hover:bg-graphite-hover transition-all",children:[I?"Hide":"More"," Filters"]})]}),I&&e.jsx("div",{className:"mb-3 -mx-3 px-3 sm:mx-0 sm:px-0 overflow-x-auto no-scrollbar",children:e.jsx("div",{className:"flex gap-1.5",children:H.slice(1).map(t=>e.jsx("button",{onClick:()=>{d(t.id),Q(!1)},className:`px-2.5 py-1 rounded-md font-medium text-xs whitespace-nowrap flex-shrink-0 transition-all ${i===t.id?"bg-neon-iris text-white shadow-md shadow-neon-iris/20":"bg-graphite-light text-moon-grey hover:bg-graphite-hover hover:text-white"}`,children:t.label},t.id))})})]}),l?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[1,2,3,4,5,6,7,8,9].map(t=>e.jsxs("div",{className:"bg-graphite-light rounded-xl p-4 border border-graphite-light animate-pulse",children:[e.jsx("div",{className:"h-4 bg-graphite-hover rounded mb-3"}),e.jsx("div",{className:"h-6 bg-graphite-hover rounded mb-2"}),e.jsx("div",{className:"h-3 bg-graphite-hover rounded w-2/3"})]},t))}):M.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-moon-grey",children:g==="my-pools"?"You haven't joined any pools yet":"No active pools found"})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:M.map(t=>{const s=G(t.id),r=E(t),c=(Number(t.shared_pool_liquidity)||0)/1e6+(Number(t.accumulated_lp_fees)||0)/1e6,N=(Number(t.accumulated_lp_fees)||0)/1e6;return e.jsxs("div",{className:"bg-graphite-light rounded-xl p-5 border border-graphite-light hover:border-neon-iris/30 transition-all",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-4",children:[t.image_url?e.jsx("img",{src:t.image_url,alt:"",className:"w-14 h-14 rounded-lg object-cover flex-shrink-0"}):e.jsx("div",{className:"w-14 h-14 rounded-lg bg-gradient-to-br from-neon-iris to-aqua-pulse flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-white font-bold text-base",children:t.question.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(ge,{to:`/market/${t.id}`,className:"text-white font-semibold hover:text-neon-iris transition-colors line-clamp-2 text-base block h-12",children:t.question}),e.jsxs("div",{className:"text-sm text-moon-grey-dark mt-1",children:[t.lp_count," LP",t.lp_count!==1?"s":""]})]})]}),e.jsxs("div",{className:"space-y-2.5 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-moon-grey-dark",children:"TVL"}),e.jsx("span",{className:"text-base font-semibold text-white tabular-nums",children:T(c)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-moon-grey-dark",children:"Fees"}),e.jsx("span",{className:"text-base font-semibold text-aqua-pulse tabular-nums",children:T(N)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-moon-grey-dark",children:"APR"}),e.jsxs("span",{className:"text-base font-semibold text-neon-iris tabular-nums",children:[r.toFixed(2),"%"]})]}),s&&e.jsx("div",{className:"pt-2.5 mt-2.5 border-t border-graphite-hover",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-moon-grey-dark",children:"Your Position"}),e.jsx("span",{className:"text-sm font-semibold text-white tabular-nums",children:p(s.current_value)})]})})]}),e.jsx("div",{className:"flex gap-2.5",children:m?s?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>X(t.id),className:"flex-1 px-4 py-2 bg-neon-iris/20 hover:bg-neon-iris/30 text-neon-iris rounded-lg font-medium text-sm transition-all",children:"Add"}),e.jsx("button",{onClick:()=>le(t.id),className:"flex-1 px-4 py-2 bg-graphite-hover hover:bg-graphite-deep text-white rounded-lg font-medium text-sm transition-all",children:"Remove"})]}):e.jsx("button",{onClick:()=>X(t.id),className:"w-full px-4 py-2 bg-neon-iris hover:bg-neon-iris/90 text-white rounded-lg font-medium text-sm transition-all",children:"Add Liquidity"}):e.jsx("button",{onClick:()=>P("/login"),className:"w-full px-4 py-2 bg-neon-iris hover:bg-neon-iris/90 text-white rounded-lg font-medium text-sm transition-all",children:"Connect to Add Liquidity"})})]},t.id)})}),v&&e.jsx("div",{className:"flex justify-center mt-6",children:e.jsx("button",{onClick:ie,disabled:x,className:"px-6 py-3 bg-graphite-light hover:bg-graphite-hover text-white rounded-lg font-medium text-sm transition-all disabled:opacity-50 disabled:cursor-not-allowed border border-graphite-light",children:x?"Loading...":"Load More"})})]}),se&&C&&m&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-sm",onClick:()=>{B(!1),S(null)}}),e.jsxs("div",{className:"relative bg-graphite-light rounded-2xl border border-white/10 p-6 max-w-md w-full shadow-2xl",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Add Liquidity"}),e.jsx("button",{onClick:()=>{B(!1),S(null)},className:"text-moon-grey hover:text-white transition-colors",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx(ye,{marketId:C,onAdded:ne})]})]}),re&&C&&m&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-sm",onClick:()=>{D(!1),S(null)}}),e.jsxs("div",{className:"relative bg-graphite-light rounded-2xl border border-white/10 p-6 max-w-md w-full shadow-2xl",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Remove Liquidity"}),e.jsx("button",{onClick:()=>{D(!1),S(null)},className:"text-moon-grey hover:text-white transition-colors",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx(we,{marketId:C,onRemoved:de})]})]})]})};export{ke as Pools};
