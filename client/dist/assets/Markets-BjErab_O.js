import{u as me,a as ge,r as s,j as e,L as ue,M as xe,f as pe,b as fe}from"./index-CPWVX6SQ.js";import{s as ve}from"./categorySort-BEAn0rC4.js";const u=9,X=async r=>(await fe.get("/market",{params:{page:r.page,limit:r.limit,category:r.category&&r.category!=="all"?r.category:void 0,search:r.search,sort:r.sort,order:r.order,status:r.status,creator_type:r.creator_type&&r.creator_type!=="all"?r.creator_type:void 0}})).data,je=()=>{const[r,W]=me(),{selectedCategory:h,setSelectedCategory:M}=ge(),[x,L]=s.useState([]),[q,U]=s.useState(1),[E,R]=s.useState(!0),[V,D]=s.useState(!1),[p,H]=s.useState(!1),[f,O]=s.useState(!1),[A,v]=s.useState(null),[b,Q]=s.useState(r.get("q")??""),[N,Y]=s.useState(b.trim()),[w,Z]=s.useState([{id:"all",label:"All Markets"}]),[I,ee]=s.useState(!1),[G,K]=s.useState(!1),[C,te]=s.useState("volume"),[S,se]=s.useState("active"),[g,P]=s.useState("admin"),c=s.useRef(0),T=s.useRef(h),_=s.useRef(N),j=s.useRef("volume"),y=s.useRef("active"),F=s.useRef("admin"),[re,ae]=s.useState(0);s.useEffect(()=>{(async()=>{try{const{categories:a}=await pe(),n=ve(a);Z([{id:"all",label:"All Markets"},...n.map(o=>({id:o.name.toLowerCase(),label:o.name}))])}catch(a){console.error("Failed to load categories:",a)}})()},[]);const B=w.some(t=>t.id===r.get("category"))?r.get("category"):"all",i=s.useCallback(()=>{L([]),U(1),R(!0),v(null),O(!1),c.current+=1,ae(t=>t+1)},[]);s.useEffect(()=>{h!==B&&(M(B),i())},[h,M,B,i]),s.useEffect(()=>{const t=window.setTimeout(()=>{Y(b.trim())},400);return()=>{window.clearTimeout(t)}},[b]),s.useEffect(()=>{T.current=h},[h]),s.useEffect(()=>{_.current=N},[N]),s.useEffect(()=>{j.current=C},[C]),s.useEffect(()=>{y.current=S},[S]),s.useEffect(()=>{F.current=g},[g]),s.useEffect(()=>{i()},[N,i]),s.useEffect(()=>{i()},[C,S,g,i]);const oe=t=>{if(t===h)return;M(t);const a=new URLSearchParams(r);t==="all"?a.delete("category"):a.set("category",t),W(a,{replace:!0}),i()};s.useEffect(()=>{if(f)return;let t=!1;const a=c.current;return(async()=>{try{D(!0),v(null);let o,m;j.current==="volume"?(o="volume",m="desc"):j.current==="newest"?(o="created",m="desc"):(o="created",m="asc");const $={page:1,limit:u,category:T.current,search:_.current||void 0,sort:o,order:m,status:y.current==="all"?"all":y.current,creator_type:F.current},l=await X($);if(t||c.current!==a)return;const k=(l==null?void 0:l.markets)??[],d=l==null?void 0:l.pagination;L(k),R(typeof(d==null?void 0:d.hasMore)=="boolean"?d.hasMore:k.length===u),O(!0)}catch(o){if(t||c.current!==a)return;console.error("Failed to load markets:",o),v(o instanceof Error?o.message:"Unable to load markets right now.")}finally{!t&&c.current===a&&D(!1)}})(),()=>{t=!0}},[f,re]);const ne=s.useCallback(async()=>{if(p||!E)return;const t=++c.current;let a=!1;try{H(!0),v(null);let n,o;j.current==="volume"?(n="volume",o="desc"):j.current==="newest"?(n="created",o="desc"):(n="created",o="asc");const m=q+1,$={page:m,limit:u,category:T.current,search:_.current||void 0,sort:n,order:o,status:y.current==="all"?"all":y.current,creator_type:F.current},l=await X($);if(a||c.current!==t)return;const k=(l==null?void 0:l.markets)??[],d=l==null?void 0:l.pagination;L(J=>{const de=new Set(J.map(z=>z.id)),he=k.filter(z=>!de.has(z.id));return[...J,...he]}),R(typeof(d==null?void 0:d.hasMore)=="boolean"?d.hasMore:k.length===u),U(m)}catch(n){if(c.current!==t)return;console.error("Failed to load more markets:",n),v(n instanceof Error?n.message:"Unable to load more markets right now.")}finally{c.current===t&&H(!1)}},[q,E,p]),le=()=>{i()},ie=(t=u)=>e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-4 mt-4",children:Array.from({length:t}).map((a,n)=>e.jsxs("div",{className:"card animate-pulse h-64 bg-graphite-deep",children:[e.jsx("div",{className:"h-4 w-24 bg-graphite-hover rounded mb-4"}),e.jsx("div",{className:"h-6 w-3/4 bg-graphite-hover rounded mb-2"}),e.jsx("div",{className:"h-6 w-2/3 bg-graphite-light rounded"})]},`skeleton-loading-${n}`))}),ce=!V&&f&&!x.length&&!A;return e.jsxs("div",{className:"max-w-7xl mx-auto px-3 sm:px-6 lg:px-8 py-4 sm:py-6 pb-20 md:pb-8",children:[e.jsxs("div",{className:"mb-5",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-4",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-white",children:"Markets"}),e.jsxs(ue,{to:"/create",className:"btn btn-outline-gradient font-semibold group hover:scale-105 active:scale-100 transition-all whitespace-nowrap inline-flex items-center justify-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5 transition-transform group-hover:rotate-90",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Create Market"]})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-graphite-deep rounded-xl p-1 border border-graphite-light inline-flex",children:[e.jsx("button",{onClick:()=>{P("admin"),i()},className:`px-4 py-1.5 rounded-lg font-medium text-sm transition-all ${g==="admin"?"bg-neon-iris text-white shadow-md shadow-neon-iris/20":"text-moon-grey hover:text-white hover:bg-graphite-light/50"}`,children:"Official"}),e.jsx("button",{onClick:()=>{P("user"),i()},className:`px-4 py-1.5 rounded-lg font-medium text-sm transition-all ${g==="user"?"bg-neon-iris text-white shadow-md shadow-neon-iris/20":"text-moon-grey hover:text-white hover:bg-graphite-light/50"}`,children:"Community"}),e.jsx("button",{onClick:()=>{P("all"),i()},className:`px-4 py-1.5 rounded-lg font-medium text-sm transition-all ${g==="all"?"bg-neon-iris text-white shadow-md shadow-neon-iris/20":"text-moon-grey hover:text-white hover:bg-graphite-light/50"}`,children:"All"})]})]}),e.jsxs("div",{className:"mb-4 flex flex-col sm:flex-row gap-2",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 pointer-events-none",children:e.jsx("svg",{className:"w-4 h-4 text-moon-grey-dark",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",placeholder:"Search markets...",value:b,onChange:t=>Q(t.target.value),className:"input w-full pl-10 pr-10"}),b&&e.jsx("button",{onClick:()=>Q(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-moon-grey-dark hover:text-white transition-colors",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>K(!G),className:"btn btn-secondary flex items-center gap-1.5 whitespace-nowrap px-3",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"})}),"Filters"]}),G&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>K(!1)}),e.jsx("div",{className:"absolute right-0 mt-2 w-56 bg-graphite-deep border border-graphite-light rounded-lg shadow-xl z-20 p-3",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-moon-grey mb-1.5",children:"Sort By"}),e.jsxs("select",{value:C,onChange:t=>te(t.target.value),className:"w-full input bg-graphite-light text-white text-sm py-1.5",children:[e.jsx("option",{value:"volume",children:"Volume"}),e.jsx("option",{value:"newest",children:"Newest"}),e.jsx("option",{value:"oldest",children:"Oldest"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-moon-grey mb-1.5",children:"Status"}),e.jsxs("select",{value:S,onChange:t=>se(t.target.value),className:"w-full input bg-graphite-light text-white text-sm py-1.5",children:[e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"resolved",children:"Resolved"}),e.jsx("option",{value:"all",children:"All"})]})]})]})})]})]})]}),e.jsx("div",{className:"mb-5 -mx-3 px-3 sm:mx-0 sm:px-0 overflow-x-auto no-scrollbar",children:e.jsxs("div",{className:"flex gap-1.5 sm:flex-wrap sm:gap-1.5",children:[(I?w:w.slice(0,8)).map(t=>e.jsx("button",{onClick:()=>oe(t.id),className:`px-3 py-1.5 rounded-lg font-medium transition-all text-sm whitespace-nowrap flex-shrink-0 ${h===t.id?"bg-neon-iris text-white shadow-md shadow-neon-iris/20":"bg-graphite-light text-moon-grey hover:bg-graphite-hover hover:text-white"}`,children:t.label},t.id)),w.length>8&&e.jsx("button",{onClick:()=>ee(!I),className:"px-3 py-1.5 rounded-lg font-medium transition-all text-sm whitespace-nowrap flex-shrink-0 bg-graphite-deep text-moon-grey-dark hover:bg-graphite-light hover:text-moon-grey border border-graphite-light",children:I?"Less":`+${w.length-8}`})]})}),A&&!x.length?e.jsxs("div",{className:"text-center py-16",children:[e.jsx("p",{className:"text-danger-400 text-lg mb-4",children:A||"Something went wrong while loading markets."}),e.jsx("button",{className:"btn btn-primary",onClick:le,children:"Try Again"})]}):ce?e.jsxs("div",{className:"text-center py-16 px-4",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-graphite-light flex items-center justify-center",children:e.jsx("svg",{className:"w-8 h-8 text-moon-grey-dark",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("p",{className:"text-moon-grey text-base sm:text-lg",children:"No markets found matching your criteria."}),e.jsx("p",{className:"text-moon-grey-dark text-sm mt-2",children:"Try adjusting your search or filters"})]}):e.jsxs(e.Fragment,{children:[V&&!f&&e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-4",children:Array.from({length:u}).map((t,a)=>e.jsxs("div",{className:"card animate-pulse h-64 bg-graphite-deep",children:[e.jsx("div",{className:"h-4 w-24 bg-graphite-hover rounded mb-4"}),e.jsx("div",{className:"h-6 w-3/4 bg-graphite-hover rounded mb-2"}),e.jsx("div",{className:"h-6 w-2/3 bg-graphite-light rounded"})]},`skeleton-initial-${a}`))}),x.length>0&&e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-4",children:x.map(t=>e.jsx(xe,{market:t},t.id))}),p&&ie(),f&&e.jsx("div",{className:"flex justify-center py-4 mt-4",children:p?e.jsxs("div",{className:"text-moon-grey flex items-center gap-2 text-sm",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-neon-iris border-t-transparent rounded-full animate-spin"}),"Loading..."]}):E?e.jsx("button",{onClick:ne,disabled:p,className:"px-6 py-2.5 rounded-xl font-medium text-sm transition-all bg-graphite-light hover:bg-graphite-hover text-white border border-graphite-light hover:border-neon-iris/30 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-graphite-light disabled:hover:border-graphite-light",children:"Load More"}):x.length>0?e.jsx("div",{className:"text-center py-2 text-moon-grey-dark text-sm",children:"End of list"}):null})]})]})};export{je as Markets};
