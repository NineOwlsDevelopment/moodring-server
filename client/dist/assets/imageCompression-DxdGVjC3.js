async function l(e,t={}){const{maxWidth:o=1600,maxHeight:a=1200,quality:i=.85,maxSizeMB:g=2,outputFormat:r}=t;return new Promise((u,m)=>{if(!e.type.startsWith("image/")){m(new Error("File is not an image"));return}const c=e.type==="image/webp",h=g*1024*1024;if(e.size<=h&&!c){const s=new Image,p=URL.createObjectURL(e);s.onload=()=>{URL.revokeObjectURL(p),s.width<=o&&s.height<=a?u(e):w(s,e,{maxWidth:o,maxHeight:a,quality:i,outputFormat:r}).then(u).catch(m)},s.onerror=()=>{URL.revokeObjectURL(p),m(new Error("Failed to load image"))},s.src=p;return}const n=new Image,d=URL.createObjectURL(e);n.onload=()=>{URL.revokeObjectURL(d),w(n,e,{maxWidth:o,maxHeight:a,quality:i,outputFormat:r}).then(u).catch(m)},n.onerror=()=>{URL.revokeObjectURL(d),m(new Error("Failed to load image"))},n.src=d})}async function w(e,t,o){const{maxWidth:a,maxHeight:i,quality:g,outputFormat:r}=o;let{width:u,height:m}=R(e.width,e.height,a,i);const c=document.createElement("canvas");c.width=u,c.height=m;const h=c.getContext("2d");if(!h)throw new Error("Failed to get canvas context");h.imageSmoothingEnabled=!0,h.imageSmoothingQuality="high",h.drawImage(e,0,0,u,m);let n=r;return n||(t.type==="image/webp"?n="image/jpeg":t.type==="image/png"&&b(c)?n="image/png":n="image/jpeg"),new Promise((d,s)=>{c.toBlob(p=>{if(!p){s(new Error("Failed to compress image"));return}const f=L(n),x=`${t.name.replace(/\.[^/.]+$/,"")}.${f}`,y=new File([p],x,{type:n,lastModified:Date.now()});d(y)},n,g)})}function R(e,t,o,a){if(e<=o&&t<=a)return{width:e,height:t};const i=e/t;let g=o,r=o/i;return r>a&&(r=a,g=a*i),{width:Math.round(g),height:Math.round(r)}}function b(e){const t=e.getContext("2d",{willReadFrequently:!0});if(!t)return!1;const a=t.getImageData(0,0,Math.min(100,e.width),Math.min(100,e.height)).data;for(let i=3;i<a.length;i+=4)if(a[i]<255)return!0;return!1}function L(e){return{"image/jpeg":"jpg","image/jpg":"jpg","image/png":"png","image/webp":"webp","image/gif":"gif"}[e]||"jpg"}async function M(e,t={}){return l(e,{maxWidth:400,maxHeight:400,quality:.8,maxSizeMB:1,...t})}async function E(e,t={}){return l(e,{maxWidth:1200,maxHeight:1200,quality:.85,maxSizeMB:2,...t})}async function F(e,t={}){return l(e,{maxWidth:600,maxHeight:600,quality:.8,maxSizeMB:1,...t})}export{E as a,M as b,F as c};
