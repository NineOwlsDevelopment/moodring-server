import{r,aU as V,t as i,j as e,i as P,L as I,aV as E,aW as $,O as A}from"./index-BhpOY4VN.js";const T=()=>{const[u,w]=r.useState([]),[M,N]=r.useState(!0),[n,v]=r.useState(1),[x,S]=r.useState(1),[h,k]=r.useState(null),[R,b]=r.useState(!1),[l,p]=r.useState(null),[d,f]=r.useState(null),[y,g]=r.useState(1),[j,m]=r.useState("");r.useEffect(()=>{o()},[n]);const o=async()=>{var s,a;try{N(!0);const t=await V({page:n,limit:50,sort:"created_at",order:"desc"});w(t.markets||[]),t.pagination&&S(t.pagination.totalPages)}catch(t){console.error("Failed to load markets:",t),i.error(((a=(s=t.response)==null?void 0:s.data)==null?void 0:a.error)||"Failed to load markets")}finally{N(!1)}},_=async()=>{var s,a;if(!(!l||!d))try{k(l.id),await A({marketId:l.id,optionId:d.id,outcome:d.option_label,winningSide:y,evidence:j.trim()?{notes:j.trim()}:void 0}),i.success("Market option resolved successfully"),b(!1),m(""),p(null),f(null),o()}catch(t){console.error("Failed to resolve market:",t),i.error(((a=(s=t.response)==null?void 0:s.data)==null?void 0:a.error)||"Failed to resolve market option")}finally{k(null)}},C=async s=>{var a,t;try{await E(s.id,{is_featured:!s.is_featured}),i.success(s.is_featured?"Market unfeatured":"Market featured successfully"),o()}catch(c){console.error("Failed to toggle featured:",c),i.error(((t=(a=c.response)==null?void 0:a.data)==null?void 0:t.error)||"Failed to update market")}},F=async s=>{var a,t;try{await $(s.id,{is_verified:!s.is_verified}),i.success(s.is_verified?"Market unverified":"Market verified successfully"),o()}catch(c){console.error("Failed to toggle verified:",c),i.error(((t=(a=c.response)==null?void 0:a.data)==null?void 0:t.error)||"Failed to update market")}},O=(s,a)=>{p(s),f(a),g(1),m(""),b(!0)};return M&&u.length===0?e.jsx("div",{className:"p-8 flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"})}):e.jsxs("div",{className:"p-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:"Manage Markets"}),e.jsx("button",{onClick:o,className:"btn btn-secondary text-sm",children:"Refresh"})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-dark-700",children:[e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-300",children:"Market"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-300",children:"Options"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-300",children:"Volume"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-300",children:"Status"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-300",children:"Flags"}),e.jsx("th",{className:"text-left py-3 px-4 font-semibold text-gray-300",children:"Actions"})]})}),e.jsx("tbody",{children:u.length>0?u.map(s=>{var a;return e.jsxs("tr",{className:"border-b border-dark-700 hover:bg-dark-800",children:[e.jsxs("td",{className:"py-3 px-4",children:[e.jsx("div",{className:"font-medium text-white",children:s.question}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["ID: ",s.id.slice(0,8),"..."]})]}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("div",{className:"space-y-1",children:(a=s.options)==null?void 0:a.map(t=>e.jsxs("div",{className:"text-sm text-gray-300 flex items-center gap-2",children:[e.jsx("span",{children:t.text||t.label||"Option"}),t.is_resolved?e.jsx("span",{className:"px-2 py-0.5 bg-green-500/20 text-green-300 border border-green-500/30 rounded text-xs",children:"Resolved"}):e.jsx("button",{onClick:()=>O(s,t),disabled:h===s.id,className:"text-xs text-primary-400 hover:text-primary-300 disabled:opacity-50",children:"Resolve"})]},t.id))})}),e.jsx("td",{className:"py-3 px-4 text-gray-300",children:P(s.total_volume||0)}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${s.is_resolved?"bg-success-500/20 text-success-300 border border-success-500/30":"bg-blue-500/20 text-blue-300 border border-blue-500/30"}`,children:s.is_resolved?"Resolved":"Active"})}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>C(s),className:`text-xs px-2 py-1 rounded ${s.is_featured?"bg-yellow-500/20 text-yellow-300 border border-yellow-500/30":"bg-gray-700 text-gray-400 border border-gray-600"}`,children:s.is_featured?"Featured":"Feature"}),e.jsx("button",{onClick:()=>F(s),className:`text-xs px-2 py-1 rounded ${s.is_verified?"bg-blue-500/20 text-blue-300 border border-blue-500/30":"bg-gray-700 text-gray-400 border border-gray-600"}`,children:s.is_verified?"Verified":"Verify"})]})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx(I,{to:`/market/${s.id}`,className:"text-primary-400 hover:text-primary-300 text-sm font-medium",children:"View"})})]},s.id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"py-3 px-4 text-center text-gray-300",children:"No markets found"})})})]})}),x>1&&e.jsxs("div",{className:"flex justify-between items-center mt-4 pt-4 border-t border-dark-700 px-4",children:[e.jsx("button",{onClick:()=>v(s=>Math.max(1,s-1)),disabled:n===1,className:"btn btn-secondary text-sm disabled:opacity-50",children:"Previous"}),e.jsxs("span",{className:"text-gray-400 text-sm",children:["Page ",n," of ",x]}),e.jsx("button",{onClick:()=>v(s=>Math.min(x,s+1)),disabled:n===x,className:"btn btn-secondary text-sm disabled:opacity-50",children:"Next"})]})]}),R&&l&&d&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"card max-w-md w-full mx-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-white mb-4",children:"Resolve Market Option"}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("p",{className:"text-gray-300 mb-2",children:[e.jsx("strong",{children:"Market:"})," ",l.question]}),e.jsxs("p",{className:"text-gray-300 mb-4",children:[e.jsx("strong",{children:"Option:"})," ",d.text||d.label||"Option"]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-white mb-2",children:"Winning Side"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",value:1,checked:y===1,onChange:()=>g(1),className:"mr-2"}),e.jsx("span",{className:"text-gray-300",children:"YES"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",value:2,checked:y===2,onChange:()=>g(2),className:"mr-2"}),e.jsx("span",{className:"text-gray-300",children:"NO"})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-white mb-2",children:"Reason (Optional)"}),e.jsx("textarea",{value:j,onChange:s=>m(s.target.value),className:"input w-full",rows:3,placeholder:"Reason for resolution..."})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{b(!1),p(null),f(null),m("")},className:"btn btn-secondary flex-1",children:"Cancel"}),e.jsx("button",{onClick:_,disabled:h===l.id,className:"btn btn-primary flex-1",children:h===l.id?"Resolving...":"Resolve"})]})]})})]})};export{T as AdminMarkets};
