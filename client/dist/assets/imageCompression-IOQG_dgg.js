async function p(e,t={}){const{maxWidth:i=1600,maxHeight:a=1200,quality:n=.85,maxSizeMB:u=2,outputFormat:m}=t;return new Promise((h,s)=>{if(!e.type.startsWith("image/")){s(new Error("File is not an image"));return}const g=u*1024*1024;if(e.size<=g){const c=new Image,d=URL.createObjectURL(e);c.onload=()=>{URL.revokeObjectURL(d),c.width<=i&&c.height<=a?h(e):w(c,e,{maxWidth:i,maxHeight:a,quality:n,outputFormat:m}).then(h).catch(s)},c.onerror=()=>{URL.revokeObjectURL(d),s(new Error("Failed to load image"))},c.src=d;return}const r=new Image,o=URL.createObjectURL(e);r.onload=()=>{URL.revokeObjectURL(o),w(r,e,{maxWidth:i,maxHeight:a,quality:n,outputFormat:m}).then(h).catch(s)},r.onerror=()=>{URL.revokeObjectURL(o),s(new Error("Failed to load image"))},r.src=o})}async function w(e,t,i){const{maxWidth:a,maxHeight:n,quality:u,outputFormat:m}=i;let{width:h,height:s}=R(e.width,e.height,a,n);const g=document.createElement("canvas");g.width=h,g.height=s;const r=g.getContext("2d");if(!r)throw new Error("Failed to get canvas context");r.imageSmoothingEnabled=!0,r.imageSmoothingQuality="high",r.drawImage(e,0,0,h,s);let o=m;return o||(t.type==="image/png"&&L(g)?o="image/png":o="image/jpeg"),new Promise((c,d)=>{g.toBlob(l=>{if(!l){d(new Error("Failed to compress image"));return}const f=U(o),x=`${t.name.replace(/\.[^/.]+$/,"")}.${f}`,y=new File([l],x,{type:o,lastModified:Date.now()});c(y)},o,u)})}function R(e,t,i,a){if(e<=i&&t<=a)return{width:e,height:t};const n=e/t;let u=i,m=i/n;return m>a&&(m=a,u=a*n),{width:Math.round(u),height:Math.round(m)}}function L(e){const t=e.getContext("2d",{willReadFrequently:!0});if(!t)return!1;const a=t.getImageData(0,0,Math.min(100,e.width),Math.min(100,e.height)).data;for(let n=3;n<a.length;n+=4)if(a[n]<255)return!0;return!1}function U(e){return{"image/jpeg":"jpg","image/jpg":"jpg","image/png":"png","image/webp":"webp","image/gif":"gif"}[e]||"jpg"}async function M(e,t={}){return p(e,{maxWidth:400,maxHeight:400,quality:.8,maxSizeMB:1,...t})}async function E(e,t={}){return p(e,{maxWidth:1200,maxHeight:1200,quality:.85,maxSizeMB:2,...t})}async function b(e,t={}){return p(e,{maxWidth:600,maxHeight:600,quality:.8,maxSizeMB:1,...t})}export{E as a,M as b,b as c};
