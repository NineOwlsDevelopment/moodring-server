async function d(e,t={}){const{maxWidth:o=1200,maxHeight:a=1200,quality:n=.85,maxSizeMB:u=2,outputFormat:s}=t;return new Promise((h,m)=>{if(!e.type.startsWith("image/")){m(new Error("File is not an image"));return}const g=u*1024*1024;if(e.size<=g){const c=new Image,p=URL.createObjectURL(e);c.onload=()=>{URL.revokeObjectURL(p),c.width<=o&&c.height<=a?h(e):w(c,e,{maxWidth:o,maxHeight:a,quality:n,outputFormat:s}).then(h).catch(m)},c.onerror=()=>{URL.revokeObjectURL(p),m(new Error("Failed to load image"))},c.src=p;return}const r=new Image,i=URL.createObjectURL(e);r.onload=()=>{URL.revokeObjectURL(i),w(r,e,{maxWidth:o,maxHeight:a,quality:n,outputFormat:s}).then(h).catch(m)},r.onerror=()=>{URL.revokeObjectURL(i),m(new Error("Failed to load image"))},r.src=i})}async function w(e,t,o){const{maxWidth:a,maxHeight:n,quality:u,outputFormat:s}=o;let{width:h,height:m}=R(e.width,e.height,a,n);const g=document.createElement("canvas");g.width=h,g.height=m;const r=g.getContext("2d");if(!r)throw new Error("Failed to get canvas context");r.imageSmoothingEnabled=!0,r.imageSmoothingQuality="high",r.drawImage(e,0,0,h,m);let i=s;return i||(L()?i="image/webp":t.type==="image/png"&&b(g)?i="image/png":i="image/jpeg"),new Promise((c,p)=>{g.toBlob(l=>{if(!l){p(new Error("Failed to compress image"));return}const f=U(i),x=`${t.name.replace(/\.[^/.]+$/,"")}.${f}`,y=new File([l],x,{type:i,lastModified:Date.now()});c(y)},i,u)})}function R(e,t,o,a){if(e<=o&&t<=a)return{width:e,height:t};const n=e/t;let u=o,s=o/n;return s>a&&(s=a,u=a*n),{width:Math.round(u),height:Math.round(s)}}function b(e){const t=e.getContext("2d",{willReadFrequently:!0});if(!t)return!1;const a=t.getImageData(0,0,Math.min(100,e.width),Math.min(100,e.height)).data;for(let n=3;n<a.length;n+=4)if(a[n]<255)return!0;return!1}function L(){try{const e=document.createElement("canvas");return e.width=1,e.height=1,e.toDataURL("image/webp").indexOf("data:image/webp")===0}catch{return!1}}function U(e){return{"image/jpeg":"jpg","image/jpg":"jpg","image/png":"png","image/webp":"webp","image/gif":"gif"}[e]||"jpg"}async function F(e,t={}){return d(e,{maxWidth:400,maxHeight:400,quality:.8,maxSizeMB:1,...t})}async function M(e,t={}){return d(e,{maxWidth:1200,maxHeight:1200,quality:.85,maxSizeMB:2,...t})}async function j(e,t={}){return d(e,{maxWidth:600,maxHeight:600,quality:.8,maxSizeMB:1,...t})}export{M as a,F as b,j as c};
