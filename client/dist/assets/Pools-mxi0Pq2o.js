import{d as Q,r as a,Q as me,j as e,i as x,b as P,ax as he,t as $,ay as xe,w as ee,a9 as be,L as te,f as pe}from"./index-BhpOY4VN.js";import{s as ge}from"./categorySort-BEAn0rC4.js";const fe=({marketId:b,onAdded:j,compact:k=!1})=>{const{user:g}=Q(),[p,c]=a.useState(!1),[l,n]=a.useState(""),[u,y]=a.useState(null),[R,q]=a.useState(!1),F=async()=>{if(g){q(!0);try{const o=(await P.get(`/market/${b}`)).data.market;y({shared_pool_liquidity:Number(o.shared_pool_liquidity||0),total_shared_lp_shares:Number(o.total_shared_lp_shares||0),accumulated_lp_fees:Number(o.accumulated_lp_fees||0),is_resolved:o.is_resolved||!1})}catch(i){console.error("Failed to load liquidity info:",i)}finally{q(!1)}}};a.useEffect(()=>{F()},[g,b]),me(b,{onMarket:i=>{i.event==="updated"&&i.data&&i.data.shared_pool_liquidity!==void 0&&y(o=>o&&{...o,shared_pool_liquidity:Number(i.data.shared_pool_liquidity),total_shared_lp_shares:Number(i.data.total_shared_lp_shares||o.total_shared_lp_shares),accumulated_lp_fees:Number(i.data.accumulated_lp_fees||o.accumulated_lp_fees)})}});const _=a.useMemo(()=>{if(!l||!u)return null;const i=parseFloat(l);if(isNaN(i)||i<=0)return null;const o=Math.floor(i*1e6),f=u.shared_pool_liquidity,m=u.total_shared_lp_shares;return m===0||f===0?(console.log("pool is empty, returning amountInMicroUSDC",o),o):Math.floor(o*m/f)},[l,u]),A=async()=>{var i,o;if(!(!g||!l||parseFloat(l)<=0)){c(!0);try{const f=await he({market:b,amount:parseFloat(l)});$.success(`Successfully added ${x(f.amount_deposited)} liquidity! You received ${x(f.shares_minted)} LP shares.`),n(""),j&&j()}catch(f){$.error(((o=(i=f.response)==null?void 0:i.data)==null?void 0:o.error)||"Failed to add liquidity. Please try again.")}finally{c(!1)}}};return g?k?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-moon-grey-dark mb-1.5",children:"Amount (USDC)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",step:"0.01",min:"0.01",value:l,onChange:i=>n(i.target.value),placeholder:"0.00",className:"w-full px-4 py-3 pr-16 bg-white/[0.03] border border-white/[0.08] rounded-xl text-white text-lg font-medium tabular-nums placeholder-moon-grey-dark focus:border-neon-iris/50 focus:ring-1 focus:ring-neon-iris/25 transition-all [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none",disabled:p}),e.jsxs("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 flex flex-col border border-white/[0.08] rounded-md overflow-hidden bg-white/[0.03] backdrop-blur-sm",children:[e.jsx("button",{type:"button",onClick:()=>{const i=parseFloat(l)||0,o=Math.max(.01,i+1);n(String(o.toFixed(2)))},disabled:p,className:"w-7 h-6 flex items-center justify-center bg-white/[0.05] hover:bg-neon-iris/20 hover:border-neon-iris/50 text-moon-grey-dark hover:text-neon-iris-light active:bg-neon-iris/30 transition-all duration-200 border-b border-white/[0.08] disabled:opacity-40 disabled:cursor-not-allowed disabled:hover:bg-white/[0.05] disabled:hover:text-moon-grey-dark group","aria-label":"Increment",children:e.jsx("svg",{className:"w-3.5 h-3.5 group-hover:scale-110 transition-transform",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M5 15l7-7 7 7"})})}),e.jsx("button",{type:"button",onClick:()=>{const i=parseFloat(l)||0,o=Math.max(.01,i-1);n(String(o.toFixed(2)))},disabled:p,className:"w-7 h-6 flex items-center justify-center bg-white/[0.05] hover:bg-neon-iris/20 hover:border-neon-iris/50 text-moon-grey-dark hover:text-neon-iris-light active:bg-neon-iris/30 transition-all duration-200 disabled:opacity-40 disabled:cursor-not-allowed disabled:hover:bg-white/[0.05] disabled:hover:text-moon-grey-dark group","aria-label":"Decrement",children:e.jsx("svg",{className:"w-3.5 h-3.5 group-hover:scale-110 transition-transform",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M19 9l-7 7-7-7"})})})]})]})]}),u&&e.jsxs("div",{className:"text-[10px] text-moon-grey-dark space-y-0.5",children:[e.jsxs("div",{children:["Pool: ",x(u.shared_pool_liquidity)]}),_!==null&&l&&parseFloat(l)>0&&e.jsxs("div",{className:"text-emerald-400/80",children:["You will receive: ",x(_).replace("$","")," ","LP shares"]})]}),e.jsx("button",{onClick:A,disabled:p||!l||parseFloat(l)<=0,className:"w-full py-2.5 rounded-xl font-semibold text-sm transition-all disabled:opacity-50 disabled:cursor-not-allowed bg-neon-iris hover:bg-neon-iris/90 text-white shadow-lg shadow-neon-iris/25",children:p?"Adding...":"Add Liquidity"}),!(u!=null&&u.is_resolved)&&e.jsx("div",{className:"bg-amber-500/10 border border-amber-500/30 rounded-lg p-2.5",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("svg",{className:"w-4 h-4 text-amber-400 flex-shrink-0 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsxs("p",{className:"text-[10px] text-amber-400/90 leading-relaxed",children:[e.jsx("span",{className:"font-semibold",children:"Funds will be locked"})," ","until the market is resolved. You can only withdraw your proportional share of available liquidity after resolution."]})]})})]}):e.jsxs("div",{className:"px-4 py-3 bg-neon-iris/10 rounded-lg border border-neon-iris/20",children:[e.jsx("h4",{className:"text-sm font-medium text-white mb-3",children:"Add Liquidity"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-moon-grey-dark mb-1.5",children:"Amount (USDC)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",step:"0.01",min:"0.01",value:l,onChange:i=>n(i.target.value),placeholder:"0.00",className:"w-full px-4 py-3 pr-16 bg-white/[0.03] border border-white/[0.08] rounded-xl text-white text-lg font-medium tabular-nums placeholder-moon-grey-dark focus:border-neon-iris/50 focus:ring-1 focus:ring-neon-iris/25 transition-all [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none",disabled:p}),e.jsxs("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 flex flex-col border border-white/[0.08] rounded-md overflow-hidden bg-white/[0.03] backdrop-blur-sm",children:[e.jsx("button",{type:"button",onClick:()=>{const i=parseFloat(l)||0,o=Math.max(.01,i+1);n(String(o.toFixed(2)))},disabled:p,className:"w-7 h-6 flex items-center justify-center bg-white/[0.05] hover:bg-neon-iris/20 hover:border-neon-iris/50 text-moon-grey-dark hover:text-neon-iris-light active:bg-neon-iris/30 transition-all duration-200 border-b border-white/[0.08] disabled:opacity-40 disabled:cursor-not-allowed disabled:hover:bg-white/[0.05] disabled:hover:text-moon-grey-dark group","aria-label":"Increment",children:e.jsx("svg",{className:"w-3.5 h-3.5 group-hover:scale-110 transition-transform",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M5 15l7-7 7 7"})})}),e.jsx("button",{type:"button",onClick:()=>{const i=parseFloat(l)||0,o=Math.max(.01,i-1);n(String(o.toFixed(2)))},disabled:p,className:"w-7 h-6 flex items-center justify-center bg-white/[0.05] hover:bg-neon-iris/20 hover:border-neon-iris/50 text-moon-grey-dark hover:text-neon-iris-light active:bg-neon-iris/30 transition-all duration-200 disabled:opacity-40 disabled:cursor-not-allowed disabled:hover:bg-white/[0.05] disabled:hover:text-moon-grey-dark group","aria-label":"Decrement",children:e.jsx("svg",{className:"w-3.5 h-3.5 group-hover:scale-110 transition-transform",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M19 9l-7 7-7-7"})})})]})]})]}),u&&e.jsxs("div",{className:"text-xs text-moon-grey space-y-1",children:[e.jsxs("div",{children:["Current Pool: ",x(u.shared_pool_liquidity)]}),u.accumulated_lp_fees>0&&e.jsxs("div",{children:["Fees Earned: ",x(u.accumulated_lp_fees)]}),_!==null&&l&&parseFloat(l)>0&&e.jsxs("div",{className:"text-emerald-400/80 font-medium pt-1 border-t border-white/5",children:["You will receive: ",x(_).replace("$","")," ","LP shares"]})]}),e.jsx("button",{onClick:A,disabled:p||!l||parseFloat(l)<=0,className:"w-full py-2.5 rounded-xl font-semibold text-sm transition-all disabled:opacity-50 disabled:cursor-not-allowed bg-neon-iris hover:bg-neon-iris/90 text-white shadow-lg shadow-neon-iris/25",children:p?"Adding...":"Add Liquidity"}),e.jsx("p",{className:"text-[10px] text-moon-grey-dark",children:"Earn fees from trading activity. LP shares represent your share of the liquidity pool."}),!(u!=null&&u.is_resolved)&&e.jsx("div",{className:"bg-amber-500/10 border border-amber-500/30 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("svg",{className:"w-4 h-4 text-amber-400 flex-shrink-0 mt-0.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs text-amber-400/90 font-semibold mb-1",children:"Funds Will Be Locked"}),e.jsx("p",{className:"text-[10px] text-amber-400/80 leading-relaxed",children:"Your liquidity will be locked until the market is resolved. After resolution, you can withdraw your proportional share of available liquidity (total liquidity minus outstanding shares redeemable)."})]})]})})]})]}):null},ve=({marketId:b,onRemoved:j})=>{const{user:k}=Q(),[g,p]=a.useState(!1),[c,l]=a.useState(""),[n,u]=a.useState(null),[y,R]=a.useState(!1),[q,F]=a.useState(!1);a.useEffect(()=>{(async()=>{if(k){R(!0);try{const v=(await P.get(`/liquidity/position/${b}`)).data.position,M=(await P.get(`/market/${b}`)).data.market;F((M==null?void 0:M.is_resolved)||!1),v&&Number(v.shares)>0?u({shares:Number(v.shares),deposited_amount:Number(v.deposited_amount),current_value:Number(v.current_value),claimable_value:Number(v.claimable_value||0)}):u(null)}catch(h){console.error("Failed to load LP position:",h),u(null)}finally{R(!1)}}})()},[k,b]);const _=async()=>{var h,v;if(!k||!n||!c||parseFloat(c)<=0)return;const m=parseFloat(c)*1e6;if(m>n.shares){$.error("Cannot remove more shares than you have");return}p(!0);try{const w=await xe({market:b,shares:m});$.success(`Successfully removed liquidity! You received ${x(w.usdc_returned)} and ${x(w.fees_earned)} in fees.`),l(""),await A(),j&&j()}catch(w){$.error(((v=(h=w.response)==null?void 0:h.data)==null?void 0:v.error)||"Failed to remove liquidity. Please try again.")}finally{p(!1)}},A=async()=>{if(k)try{const h=(await P.get(`/liquidity/position/${b}`)).data.position,w=(await P.get(`/market/${b}`)).data.market;F((w==null?void 0:w.is_resolved)||!1),h&&Number(h.shares)>0?u({shares:Number(h.shares),deposited_amount:Number(h.deposited_amount),current_value:Number(h.current_value),claimable_value:Number(h.claimable_value||0)}):u(null)}catch(m){console.error("Failed to load LP position:",m),u(null)}};if(!k)return null;if(y)return e.jsx("div",{className:"py-2 text-sm text-gray-400",children:"Loading LP position..."});if(!n||n.shares<=0)return e.jsx("div",{className:"text-sm text-moon-grey-dark",children:"You don't have any liquidity in this pool"});const i=n.shares/1e6,o=n.claimable_value??n.current_value,f=c?parseFloat(c)/i*o:0;return q?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-moon-grey-dark mb-1.5",children:"LP Shares to Remove"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",step:"0.01",min:"0.01",max:i,value:c,onChange:m=>l(m.target.value),placeholder:"0.00",className:"w-full px-4 py-3 pr-16 bg-white/[0.03] border border-white/[0.08] rounded-xl text-white text-lg font-medium tabular-nums placeholder-moon-grey-dark focus:border-neon-iris/50 focus:ring-1 focus:ring-neon-iris/25 transition-all [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none",disabled:g}),e.jsxs("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 flex flex-col border border-white/[0.08] rounded-md overflow-hidden bg-white/[0.03] backdrop-blur-sm",children:[e.jsx("button",{type:"button",onClick:()=>{const m=parseFloat(c)||0,h=Math.min(i,Math.max(.01,m+1));l(String(h.toFixed(2)))},disabled:g,className:"w-7 h-6 flex items-center justify-center bg-white/[0.05] hover:bg-neon-iris/20 hover:border-neon-iris/50 text-moon-grey-dark hover:text-neon-iris-light active:bg-neon-iris/30 transition-all duration-200 border-b border-white/[0.08] disabled:opacity-40 disabled:cursor-not-allowed disabled:hover:bg-white/[0.05] disabled:hover:text-moon-grey-dark group","aria-label":"Increment",children:e.jsx("svg",{className:"w-3.5 h-3.5 group-hover:scale-110 transition-transform",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M5 15l7-7 7 7"})})}),e.jsx("button",{type:"button",onClick:()=>{const m=parseFloat(c)||0,h=Math.max(.01,m-1);l(String(h.toFixed(2)))},disabled:g,className:"w-7 h-6 flex items-center justify-center bg-white/[0.05] hover:bg-neon-iris/20 hover:border-neon-iris/50 text-moon-grey-dark hover:text-neon-iris-light active:bg-neon-iris/30 transition-all duration-200 disabled:opacity-40 disabled:cursor-not-allowed disabled:hover:bg-white/[0.05] disabled:hover:text-moon-grey-dark group","aria-label":"Decrement",children:e.jsx("svg",{className:"w-3.5 h-3.5 group-hover:scale-110 transition-transform",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M19 9l-7 7-7-7"})})})]})]}),e.jsxs("div",{className:"flex items-center justify-between mt-1",children:[e.jsxs("span",{className:"text-xs text-moon-grey-dark",children:["Max: ",x(n.shares)," LP"]}),e.jsx("button",{onClick:()=>l(i.toString()),className:"text-xs text-neon-iris hover:text-neon-iris/80 transition-colors",children:"Max"})]})]}),c&&parseFloat(c)>0&&e.jsxs("div",{className:"bg-white/5 rounded-lg p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-moon-grey-dark",children:"You'll Receive"}),e.jsx("span",{className:"text-white font-semibold tabular-nums",children:x(f)})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-moon-grey-dark",children:[e.jsx("span",{children:"From Available Liquidity"}),e.jsxs("span",{className:"text-moon-grey",children:[x(o)," available"]})]})]}),e.jsxs("div",{className:"text-xs text-moon-grey-dark space-y-1",children:[e.jsxs("div",{children:["Your Position: ",x(n.current_value)," (",x(n.shares)," LP)"]}),n.claimable_value!==void 0&&n.claimable_value<n.current_value&&e.jsxs("div",{className:"text-amber-400",children:["Note: Only ",x(o)," is available for withdrawal. The remaining liquidity is reserved for outstanding shares redeemable."]})]}),e.jsx("button",{onClick:_,disabled:g||!c||parseFloat(c)<=0||parseFloat(c)>i,className:"w-full py-2.5 rounded-xl font-semibold text-sm transition-all disabled:opacity-50 disabled:cursor-not-allowed bg-rose-500 hover:bg-rose-400 text-white shadow-lg shadow-rose-500/25",children:g?"Removing...":"Remove Liquidity"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-amber-500/10 border border-amber-500/30 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("svg",{className:"w-5 h-5 text-amber-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),e.jsx("h3",{className:"text-sm font-semibold text-amber-400",children:"LP Shares Locked"})]}),e.jsx("p",{className:"text-xs text-amber-400/80",children:"Your LP shares are locked until the market is resolved. Once the market resolves, you can withdraw your proportional share of available liquidity (total liquidity minus outstanding shares redeemable)."})]}),e.jsx("div",{className:"text-xs text-moon-grey-dark space-y-1",children:e.jsxs("div",{children:["Your Position: ",x(n.current_value)," (",x(n.shares).replace("$","")," LP)"]})})]})},G=9,je=()=>{const{user:b}=Q(),[j,k]=a.useState("all"),[g,p]=a.useState("admin"),[c,l]=a.useState("all"),[n,u]=a.useState("tvl"),[y,R]=a.useState([]),[q,F]=a.useState([]),[_,A]=a.useState([]),[i,o]=a.useState(!0),[f,m]=a.useState(!1),[h,v]=a.useState(!1),[w,M]=a.useState(1),[C,S]=a.useState(null),[se,B]=a.useState(!1),[re,D]=a.useState(!1),[O,J]=a.useState(!1),[I,ae]=a.useState([{id:"all",label:"All Categories"}]),V=a.useRef(null),W=a.useCallback(t=>{const s=(Number(t.shared_pool_liquidity)||0)/1e6;if(!s||s===0)return 0;const r=(Number(t.accumulated_lp_fees)||0)/1e6,d=(Date.now()-Number(t.created_at)*1e3)/(1e3*60*60*24),N=Math.max(1,d);return r/s*365/N*100},[]),H=a.useCallback(t=>_.find(s=>s.market_id===t),[_]),E=a.useCallback(t=>{let s=[...t];return j==="my-pools"&&(s=s.filter(r=>H(r.id))),c!=="all"&&(s=s.filter(r=>{var d;return((d=r.categories)==null?void 0:d.some(N=>N.name.toLowerCase()===c))||!1})),s},[j,c,H]),Y=a.useCallback(t=>{const s=[...t];return s.sort((r,d)=>{switch(n){case"tvl":{const N=(Number(r.shared_pool_liquidity)||0)/1e6+(Number(r.accumulated_lp_fees)||0)/1e6;return(Number(d.shared_pool_liquidity)||0)/1e6+(Number(d.accumulated_lp_fees)||0)/1e6-N}case"apr":return W(d)-W(r);case"fees":{const N=(Number(r.accumulated_lp_fees)||0)/1e6;return(Number(d.accumulated_lp_fees)||0)/1e6-N}case"newest":return Number(d.created_at)-Number(r.created_at);case"oldest":return Number(r.created_at)-Number(d.created_at);case"volume":return Number(d.total_volume||0)-Number(r.total_volume||0);default:return 0}}),s},[n,W]),U=a.useCallback((t,s)=>{R(r=>r.map(d=>d.id===t?{...d,...s}:d))},[]);a.useEffect(()=>{(async()=>{try{const{categories:s}=await pe(),r=ge(s);ae([{id:"all",label:"All Categories"},...r.map(d=>({id:d.name.toLowerCase(),label:d.name}))])}catch(s){console.error("Failed to load categories:",s)}})()},[]),a.useEffect(()=>{ee.connect();const t=r=>{r.event==="updated"&&r.data&&V.current===r.market_id&&(U(r.market_id,{shared_pool_liquidity:Number(r.data.shared_pool_liquidity||0),total_shared_lp_shares:Number(r.data.total_shared_lp_shares||0),accumulated_lp_fees:Number(r.data.accumulated_lp_fees||0)}),b&&z(),V.current=null)},s=ee.onMarket(t);return()=>s()},[b,U]),a.useEffect(()=>{const t=E(y),s=Y(t);M(1),F(s.slice(0,G)),v(s.length>G)},[y,E,Y]);const ie=async(t=!0)=>{t?(o(!0),M(1)):m(!0);try{const d=((await P.get("/market",{params:{status:"active",limit:1e3,creator_type:g,category:c!=="all"?c:void 0}})).data.markets||[]).filter(L=>L.is_initialized&&Number(L.shared_pool_liquidity||0)>0&&!L.is_resolved),N=await Promise.all(d.map(async L=>{try{const Z=await P.get(`/liquidity/share-value/${L.id}`);return{...L,lp_count:Z.data.lp_count||0}}catch{return{...L,lp_count:0}}}));R(N)}catch(s){console.error("Failed to load pools:",s),$.error("Failed to load pools")}finally{o(!1),m(!1)}};a.useEffect(()=>{ie(),b&&z()},[b,g,c]);const z=async()=>{try{const t=await be();A(t.positions)}catch(t){console.error("Failed to load positions:",t)}},oe=a.useCallback(()=>{f||!h||(m(!0),setTimeout(()=>{const t=E(y),s=Y(t),r=w+1,d=s.slice(0,r*G);F(d),M(r),v(d.length<s.length),m(!1)},100))},[y,w,f,h,E,Y]),K=t=>{V.current=t,S(t),B(!0)},le=t=>{V.current=t,S(t),D(!0)},X=a.useCallback(async t=>{try{const r=(await P.get(`/market/${t}`)).data.market;U(t,{shared_pool_liquidity:Number(r.shared_pool_liquidity||0),total_shared_lp_shares:Number(r.total_shared_lp_shares||0),accumulated_lp_fees:Number(r.accumulated_lp_fees||0)})}catch(s){console.error("Failed to reload pool:",s)}},[U]),ne=async()=>{z(),C&&await X(C),B(!1),S(null)},de=async()=>{z(),C&&await X(C),D(!1),S(null)},ce=y.reduce((t,s)=>t+(Number(s.shared_pool_liquidity)||0)/1e6+(Number(s.accumulated_lp_fees)||0)/1e6,0),ue=y.reduce((t,s)=>t+(Number(s.accumulated_lp_fees)||0)/1e6,0),T=t=>{if(t>=1e6){const s=t/1e6,r=Math.round(s*100)/100;return`$${r.toFixed(r%1===0?0:2)}M`}if(t>=1e3){const s=t/1e3,r=Math.round(s*100)/100;return`$${r.toFixed(r%1===0?0:2)}k`}return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(t)};return b?e.jsxs("div",{className:"max-w-7xl mx-auto px-3 sm:px-6 lg:px-8 py-4 sm:py-6 pb-20 md:pb-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-4",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-white",children:"Pools"}),e.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[e.jsxs("div",{className:"text-moon-grey-dark",children:[e.jsx("span",{className:"text-moon-grey",children:"TVL: "}),e.jsx("span",{className:"text-white font-semibold tabular-nums",children:T(ce)})]}),e.jsxs("div",{className:"text-moon-grey-dark",children:[e.jsx("span",{className:"text-moon-grey",children:"Fees: "}),e.jsx("span",{className:"text-emerald-400 font-semibold tabular-nums",children:T(ue)})]}),e.jsx("div",{className:"text-moon-grey-dark",children:e.jsxs("span",{className:"text-moon-grey",children:[y.length," pools"]})})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-1 bg-graphite-deep rounded-lg p-1 border border-graphite-light",children:[e.jsx("button",{onClick:()=>k("all"),className:`px-3 py-1 rounded-md font-medium text-xs transition-all ${j==="all"?"bg-graphite-light text-white":"text-moon-grey hover:text-white"}`,children:"All"}),e.jsxs("button",{onClick:()=>k("my-pools"),className:`px-3 py-1 rounded-md font-medium text-xs transition-all ${j==="my-pools"?"bg-graphite-light text-white":"text-moon-grey hover:text-white"}`,children:["My Pools (",_.length,")"]})]}),e.jsxs("div",{className:"flex items-center gap-1 bg-graphite-deep rounded-lg p-1 border border-graphite-light",children:[e.jsx("button",{onClick:()=>p("admin"),className:`px-3 py-1 rounded-md font-medium text-xs transition-all ${g==="admin"?"bg-neon-iris text-white shadow-md shadow-neon-iris/20":"text-moon-grey hover:text-white"}`,children:"Official"}),e.jsx("button",{onClick:()=>p("user"),className:`px-3 py-1 rounded-md font-medium text-xs transition-all ${g==="user"?"bg-neon-iris text-white shadow-md shadow-neon-iris/20":"text-moon-grey hover:text-white"}`,children:"Community"}),e.jsx("button",{onClick:()=>p("all"),className:`px-3 py-1 rounded-md font-medium text-xs transition-all ${g==="all"?"bg-neon-iris text-white shadow-md shadow-neon-iris/20":"text-moon-grey hover:text-white"}`,children:"All"})]}),e.jsx("select",{value:c,onChange:t=>l(t.target.value),className:"px-3 py-1 rounded-lg font-medium text-xs bg-graphite-light text-white border border-graphite-light hover:bg-graphite-hover transition-all focus:outline-none focus:ring-1 focus:ring-neon-iris/50",children:I.map(t=>e.jsx("option",{value:t.id,children:t.label},t.id))}),e.jsxs("select",{value:n,onChange:t=>u(t.target.value),className:"px-3 py-1 rounded-lg font-medium text-xs bg-graphite-light text-white border border-graphite-light hover:bg-graphite-hover transition-all focus:outline-none focus:ring-1 focus:ring-neon-iris/50",children:[e.jsx("option",{value:"tvl",children:"Sort: TVL â†“"}),e.jsx("option",{value:"apr",children:"Sort: APR â†“"}),e.jsx("option",{value:"fees",children:"Sort: Fees â†“"}),e.jsx("option",{value:"volume",children:"Sort: Volume â†“"}),e.jsx("option",{value:"newest",children:"Sort: Newest"}),e.jsx("option",{value:"oldest",children:"Sort: Oldest"})]}),I.length>8&&e.jsxs("button",{onClick:()=>J(!O),className:"px-3 py-1 rounded-lg font-medium text-xs bg-graphite-light text-moon-grey hover:text-white border border-graphite-light hover:bg-graphite-hover transition-all",children:[O?"Hide":"More"," Filters"]})]}),O&&e.jsx("div",{className:"mb-3 -mx-3 px-3 sm:mx-0 sm:px-0 overflow-x-auto no-scrollbar",children:e.jsx("div",{className:"flex gap-1.5",children:I.slice(1).map(t=>e.jsx("button",{onClick:()=>{l(t.id),J(!1)},className:`px-2.5 py-1 rounded-md font-medium text-xs whitespace-nowrap flex-shrink-0 transition-all ${c===t.id?"bg-neon-iris text-white shadow-md shadow-neon-iris/20":"bg-graphite-light text-moon-grey hover:bg-graphite-hover hover:text-white"}`,children:t.label},t.id))})})]}),i?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[1,2,3,4,5,6,7,8,9].map(t=>e.jsxs("div",{className:"bg-graphite-light rounded-xl p-4 border border-graphite-light animate-pulse",children:[e.jsx("div",{className:"h-4 bg-graphite-hover rounded mb-3"}),e.jsx("div",{className:"h-6 bg-graphite-hover rounded mb-2"}),e.jsx("div",{className:"h-3 bg-graphite-hover rounded w-2/3"})]},t))}):q.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-moon-grey",children:j==="my-pools"?"You haven't joined any pools yet":"No active pools found"})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:q.map(t=>{const s=H(t.id),r=W(t),d=(Number(t.shared_pool_liquidity)||0)/1e6+(Number(t.accumulated_lp_fees)||0)/1e6,N=(Number(t.accumulated_lp_fees)||0)/1e6;return e.jsxs("div",{className:"bg-graphite-light rounded-xl p-4 border border-graphite-light hover:border-neon-iris/30 transition-all",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-3",children:[t.image_url?e.jsx("img",{src:t.image_url,alt:"",className:"w-10 h-10 rounded-lg object-cover flex-shrink-0"}):e.jsx("div",{className:"w-10 h-10 rounded-lg bg-gradient-to-br from-neon-iris to-aqua-pulse flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-white font-bold text-sm",children:t.question.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(te,{to:`/market/${t.id}`,className:"text-white font-semibold hover:text-neon-iris transition-colors line-clamp-2 text-sm",children:t.question}),e.jsxs("div",{className:"text-xs text-moon-grey-dark mt-0.5",children:[t.lp_count," LP",t.lp_count!==1?"s":""]})]})]}),e.jsxs("div",{className:"space-y-2 mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-moon-grey-dark",children:"TVL"}),e.jsx("span",{className:"text-sm font-semibold text-white tabular-nums",children:T(d)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-moon-grey-dark",children:"Fees"}),e.jsx("span",{className:"text-sm font-semibold text-emerald-400 tabular-nums",children:T(N)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-moon-grey-dark",children:"APR"}),e.jsxs("span",{className:"text-sm font-semibold text-neon-iris tabular-nums",children:[r.toFixed(2),"%"]})]}),s&&e.jsx("div",{className:"pt-2 mt-2 border-t border-graphite-hover",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-moon-grey-dark",children:"Your Position"}),e.jsx("span",{className:"text-xs font-semibold text-white tabular-nums",children:x(s.current_value)})]})})]}),e.jsx("div",{className:"flex gap-2",children:s?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>K(t.id),className:"flex-1 px-3 py-1.5 bg-neon-iris/20 hover:bg-neon-iris/30 text-neon-iris rounded-lg font-medium text-xs transition-all",children:"Add"}),e.jsx("button",{onClick:()=>le(t.id),className:"flex-1 px-3 py-1.5 bg-graphite-hover hover:bg-graphite-deep text-white rounded-lg font-medium text-xs transition-all",children:"Remove"})]}):e.jsx("button",{onClick:()=>K(t.id),className:"w-full px-3 py-1.5 bg-neon-iris hover:bg-neon-iris/90 text-white rounded-lg font-medium text-xs transition-all",children:"Add Liquidity"})})]},t.id)})}),h&&e.jsx("div",{className:"flex justify-center mt-6",children:e.jsx("button",{onClick:oe,disabled:f,className:"px-6 py-3 bg-graphite-light hover:bg-graphite-hover text-white rounded-lg font-medium text-sm transition-all disabled:opacity-50 disabled:cursor-not-allowed border border-graphite-light",children:f?"Loading...":"Load More"})})]}),se&&C&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-sm",onClick:()=>{B(!1),S(null)}}),e.jsxs("div",{className:"relative bg-graphite-light rounded-2xl border border-white/10 p-6 max-w-md w-full shadow-2xl",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Add Liquidity"}),e.jsx("button",{onClick:()=>{B(!1),S(null)},className:"text-moon-grey hover:text-white transition-colors",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx(fe,{marketId:C,onAdded:ne})]})]}),re&&C&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-sm",onClick:()=>{D(!1),S(null)}}),e.jsxs("div",{className:"relative bg-graphite-light rounded-2xl border border-white/10 p-6 max-w-md w-full shadow-2xl",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Remove Liquidity"}),e.jsx("button",{onClick:()=>{D(!1),S(null)},className:"text-moon-grey hover:text-white transition-colors",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx(ve,{marketId:C,onRemoved:de})]})]})]}):e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16 text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ’§"}),e.jsx("h1",{className:"text-3xl font-bold text-white mb-4",children:"Liquidity Pools"}),e.jsx("p",{className:"text-gray-400 mb-6",children:"Connect your wallet to view and manage liquidity pools"}),e.jsx(te,{to:"/login",className:"inline-block px-6 py-3 bg-neon-iris hover:bg-neon-iris/90 text-white rounded-xl font-semibold transition-all",children:"Connect Wallet"})]})};export{je as Pools};
