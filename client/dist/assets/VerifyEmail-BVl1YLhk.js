import{r as n,a4 as N,u as w,d as k,j as e,b as f,au as E,av as S,t as C}from"./index-BvLxgWIs.js";const V=()=>{const[o,b]=n.useState(""),[c,d]=n.useState(!1),[u,s]=n.useState(""),[r,x]=n.useState(""),h=N(),[p]=w(),{setUser:g}=k();n.useEffect(()=>{const a=p.get("email");a&&x(a)},[p]);const v=async a=>{var l,i;a.preventDefault(),s(""),d(!0);try{const t=await f.post("/auth/magic-link/verify",{otp:o.trim(),email:r||void 0});if(t.status===200){localStorage.setItem("hasPreviousSession","true");const m=t.data.user.wallet.publicKey||t.data.user.wallet.public_key,y=m?typeof m=="string"?new E(m):m:null;if(!y)throw new Error("No public key found in wallet data");g({id:t.data.user.id,username:t.data.user.username,display_name:t.data.user.display_name,email:t.data.user.email,isAdmin:t.data.user.isAdmin||!1,wallet:{id:t.data.user.wallet.id,publicKey:y,balance_sol:t.data.user.wallet.balance_sol,balance_usdc:t.data.user.wallet.balance_usdc}}),S(),h("/")}else s(t.data.error||"Invalid verification code")}catch(t){s(((i=(l=t.response)==null?void 0:l.data)==null?void 0:i.error)||"Invalid verification code. Please try again.")}finally{d(!1)}},j=async()=>{var a,l;if(!r){s("Email is required to resend code");return}s(""),d(!0);try{const i=await f.post("/auth/email/send-magic-link",{email:r});i.data.success?(s(""),C.success("Verification code resent! Please check your email.")):s(i.data.error||"Failed to resend code")}catch(i){s(((l=(a=i.response)==null?void 0:a.data)==null?void 0:l.error)||"Failed to resend code. Please try again.")}finally{d(!1)}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-dark-950 px-4",children:e.jsx("div",{className:"w-full max-w-md",children:e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-16 h-16 bg-primary-500/20 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-primary-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("h1",{className:"text-2xl font-bold text-white mb-2",children:"Verify Your Email"}),e.jsx("p",{className:"text-gray-400 text-sm",children:r?`Enter the verification code sent to ${r}`:"Enter the verification code from your email"})]}),e.jsxs("form",{onSubmit:v,className:"space-y-4",children:[!r&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Email Address"}),e.jsx("input",{type:"email",value:r,onChange:a=>x(a.target.value),placeholder:"your@email.com",className:"input",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Verification Code"}),e.jsx("input",{type:"text",value:o,onChange:a=>b(a.target.value.toUpperCase()),placeholder:"Enter 6-digit code",className:"input text-center text-2xl tracking-widest font-mono",maxLength:6,required:!0,disabled:c,autoFocus:!0}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Check your email for the verification code"})]}),u&&e.jsx("div",{className:"text-sm text-danger-400 bg-danger-400/20 p-3 rounded-lg",children:u}),e.jsx("button",{type:"submit",disabled:c||!o||o.length!==6,className:"btn btn-primary w-full",children:c?"Verifying...":"Verify Email"}),r&&e.jsx("div",{className:"text-center",children:e.jsx("button",{type:"button",onClick:j,disabled:c,className:"text-sm text-primary-400 hover:text-primary-300 transition-colors disabled:opacity-50",children:"Didn't receive the code? Resend"})})]}),e.jsx("div",{className:"mt-6 pt-6 border-t border-dark-800 text-center",children:e.jsx("button",{onClick:()=>h("/"),className:"text-sm text-gray-400 hover:text-white transition-colors",children:"‚Üê Back to Home"})})]})})})};export{V as VerifyEmail};
