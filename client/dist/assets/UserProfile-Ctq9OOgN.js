import{c as E,r as d,K as Se,j as e,X as se,d as Ce,i as Ye,Z as Be,a7 as me,b as Ue,t as y,aG as ze,aH as De,aI as Ie,aJ as Ve,aK as He,aL as We,L as xe,aM as Ne,ak as te,V as ke,aN as Qe,aO as _e,aP as de,aQ as Ge,aR as Oe,x as re,aS as Je,aT as Xe,aU as Ze,aV as et,aW as tt}from"./index-DUKhzUo-.js";import{A as st}from"./arrow-left-ClsIWP3Q.js";import{T as rt,A as at,a as nt}from"./trending-down-Cy2MS9Uz.js";import{S as it}from"./share-2-CsZzko_b.js";/**
 * @license lucide-react v0.556.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lt=[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]],ot=E("award",lt);/**
 * @license lucide-react v0.556.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dt=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]],ct=E("circle-plus",dt);/**
 * @license lucide-react v0.556.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xt=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]],mt=E("ellipsis-vertical",xt);/**
 * @license lucide-react v0.556.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ht=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],ut=E("external-link",ht);/**
 * @license lucide-react v0.556.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gt=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],pt=E("file-text",gt);/**
 * @license lucide-react v0.556.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bt=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]],Pe=E("heart",bt);/**
 * @license lucide-react v0.556.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wt=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],yt=E("image",wt);/**
 * @license lucide-react v0.556.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ft=[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]],J=E("key",ft);/**
 * @license lucide-react v0.556.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jt=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],vt=E("lock",jt);/**
 * @license lucide-react v0.556.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nt=[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]],he=E("message-circle",Nt);/**
 * @license lucide-react v0.556.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kt=[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]],_t=E("video",kt),St=({isOpen:s,onClose:l,imageUrl:x,alt:t="Image"})=>{if(d.useEffect(()=>{if(!s)return;const o=f=>{f.key==="Escape"&&l()};return document.addEventListener("keydown",o),document.body.style.overflow="hidden",()=>{document.removeEventListener("keydown",o),document.body.style.overflow=""}},[s,l]),!s)return null;const m=()=>document.getElementById("root")||document.body;return Se.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",onClick:l,children:[e.jsx("div",{className:"absolute inset-0 bg-black/90 backdrop-blur-sm"}),e.jsxs("div",{className:"relative max-w-7xl max-h-[95vh] w-full h-full flex items-center justify-center",onClick:o=>o.stopPropagation(),children:[e.jsx("button",{onClick:l,className:"absolute top-4 right-4 z-10 w-10 h-10 flex items-center justify-center text-white hover:text-neon-iris bg-black/50 hover:bg-black/70 rounded-full transition-all backdrop-blur-sm","aria-label":"Close image",children:e.jsx(se,{className:"w-6 h-6"})}),e.jsx("img",{src:x,alt:t,className:"max-w-full max-h-[95vh] object-contain rounded-lg",onClick:o=>o.stopPropagation()})]})]}),m())};function Ct(s){return s<0?0:s*s/16e3}function Pt(s,l){if(l<=0)return 0;s<0&&(s=0);const x=s+l,t=(Math.pow(x,3)-Math.pow(s,3))/48e3;return Math.max(0,t)}function $t(s,l){if(l<=0||s<=0)return 0;s<l&&(l=s);const x=s,t=s-l,m=(Math.pow(x,3)-Math.pow(t,3))/48e3;return Math.max(0,m)}const qt=({isOpen:s,onClose:l,traderName:x,currentSupply:t,currentPrice:m,keyOwnership:o,isTrader:f=!1,requiredKeysToFollow:_=1,onBuy:T,onSell:M})=>{var z,b;const{user:k}=Ce(),[h,L]=d.useState("buy"),[S,P]=d.useState(""),[F,B]=d.useState(!1),[N,j]=d.useState(null);if(d.useEffect(()=>{if(!s)return;const n=a=>{a.key==="Escape"&&l()};return document.addEventListener("keydown",n),document.body.style.overflow="hidden",()=>{document.removeEventListener("keydown",n),document.body.style.overflow=""}},[s,l]),!s)return null;const R=Math.max(1,t),A=typeof o=="number"?o:parseFloat(String(o))||0,w=parseFloat(S)||0,K=h==="buy"&&w>0?Pt(R,w):0,U=h==="sell"&&w>0?$t(R,w):0,H=async()=>{var a,p,u;if(F)return;if(j(null),!S||S.trim()===""){j("Please enter an amount");return}const n=parseFloat(S);if(isNaN(n)||n<=0){j("Please enter a valid amount");return}if(h==="sell"){if(f){const g=Math.max(0,R-1);if(n>g+1e-6){j(`You can only sell up to ${g.toFixed(2)} keys`);return}}else if(n>A+1e-6){j(`You only own ${A.toFixed(2)} keys`);return}}if(h==="buy"&&k){const g=(((a=k.wallet)==null?void 0:a.balance_usdc)||0)/1e6;if(K>g){j("Insufficient balance");return}}B(!0);try{h==="buy"?await T(n):await M(n),l(),P(""),j(null)}catch(g){console.error("Transaction failed:",g),j(((u=(p=g==null?void 0:g.response)==null?void 0:p.data)==null?void 0:u.error)||(g==null?void 0:g.message)||"Transaction failed")}finally{B(!1)}},Y=()=>document.getElementById("root")||document.body;return Se.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-2 sm:p-4 overflow-hidden",onClick:l,children:[e.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-sm"}),e.jsxs("div",{className:"relative bg-graphite-deep rounded-2xl border border-white/10 p-4 sm:p-6 max-w-md w-full max-h-[90vh] overflow-y-auto shadow-2xl animate-scale-in min-w-0",onClick:n=>n.stopPropagation(),children:[e.jsx("button",{onClick:l,className:"absolute top-4 right-4 w-8 h-8 flex items-center justify-center text-moon-grey hover:text-white transition-colors rounded-lg hover:bg-white/5","aria-label":"Close",children:e.jsx(se,{className:"w-5 h-5"})}),e.jsxs("div",{className:"mb-6 pr-8",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1 min-w-0",children:[e.jsx(J,{className:"w-5 h-5 text-neon-iris flex-shrink-0"}),e.jsx("h2",{className:"text-xl font-bold text-white truncate",children:h==="buy"?"Buy Keys":"Sell Keys"})]}),e.jsx("p",{className:"text-sm text-gray-400 truncate",children:x||"Trader"})]}),e.jsxs("div",{className:"flex gap-2 mb-6 bg-white/5 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>{L("buy"),P(""),j(null)},className:`flex-1 py-2.5 px-4 rounded-md text-sm font-semibold transition-all ${h==="buy"?"bg-muted-green text-white shadow-lg shadow-muted-green/20":"text-gray-400 hover:text-white"}`,children:"Buy"}),e.jsx("button",{onClick:()=>{L("sell"),P(""),j(null)},disabled:!f&&A===0,className:`flex-1 py-2.5 px-4 rounded-md text-sm font-semibold transition-all ${h==="sell"?"bg-rose-500 text-white shadow-lg shadow-rose-500/20":"text-gray-400 hover:text-white disabled:opacity-50 disabled:cursor-not-allowed"}`,children:"Sell"})]}),e.jsx("div",{className:"bg-gradient-to-br from-white/5 to-white/[0.02] rounded-xl p-4 sm:p-5 mb-5 border border-white/10",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 min-w-0",children:[e.jsx("span",{className:"text-sm text-gray-400 flex-shrink-0",children:"Price per Key"}),e.jsxs("span",{className:"text-xl font-bold text-white tabular-nums truncate text-right",children:["$",(m||Ct(R)).toFixed(4)]})]}),k&&e.jsxs("div",{className:"flex items-center justify-between gap-2 pt-3 border-t border-white/10 min-w-0",children:[e.jsx("span",{className:"text-sm text-gray-400 flex-shrink-0",children:"Your Balance"}),e.jsxs("span",{className:"text-base font-semibold text-white tabular-nums truncate text-right",children:[Ye(((z=k.wallet)==null?void 0:z.balance_usdc)||0)," USDC"]})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2 pt-3 border-t border-white/10 min-w-0",children:[e.jsx("span",{className:"text-sm text-gray-400 flex-shrink-0",children:f?h==="sell"?"Keys You Can Sell":"Your Keys":"Keys You Own"}),e.jsx("span",{className:"text-base font-semibold text-white tabular-nums truncate text-right",children:f?h==="sell"?Math.max(0,R-1).toFixed(2):R.toFixed(2):A.toFixed(2)})]})]})}),e.jsxs("div",{className:"mb-5",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-3",children:"How many keys?"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",step:"any",min:"0",value:S,onChange:n=>{P(n.target.value),j(null)},placeholder:"Enter amount",className:"w-full px-4 py-3 pr-16 bg-white/5 border border-white/10 rounded-lg text-white text-center placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-neon-iris/50 focus:border-neon-iris text-base sm:text-lg font-semibold tabular-nums [appearance:textfield] [&::-webkit-outer-spin-button]:appearance-none [&::-webkit-inner-spin-button]:appearance-none",disabled:F}),e.jsxs("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 flex flex-col border border-white/[0.08] rounded-md overflow-hidden bg-white/[0.03] backdrop-blur-sm",children:[e.jsx("button",{type:"button",onClick:()=>{const a=(parseFloat(S)||0)+1;P(String(a)),j(null)},disabled:F,className:"w-7 h-6 flex items-center justify-center bg-white/[0.05] hover:bg-neon-iris/20 hover:border-neon-iris/50 text-moon-grey-dark hover:text-neon-iris-light active:bg-neon-iris/30 transition-all duration-200 border-b border-white/[0.08] disabled:opacity-40 disabled:cursor-not-allowed disabled:hover:bg-white/[0.05] disabled:hover:text-moon-grey-dark group","aria-label":"Increment",children:e.jsx("svg",{className:"w-3.5 h-3.5 group-hover:scale-110 transition-transform",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M5 15l7-7 7 7"})})}),e.jsx("button",{type:"button",onClick:()=>{const n=parseFloat(S)||0,a=Math.max(0,n-1);P(a>0?String(a):""),j(null)},disabled:F,className:"w-7 h-6 flex items-center justify-center bg-white/[0.05] hover:bg-neon-iris/20 hover:border-neon-iris/50 text-moon-grey-dark hover:text-neon-iris-light active:bg-neon-iris/30 transition-all duration-200 disabled:opacity-40 disabled:cursor-not-allowed disabled:hover:bg-white/[0.05] disabled:hover:text-moon-grey-dark group","aria-label":"Decrement",children:e.jsx("svg",{className:"w-3.5 h-3.5 group-hover:scale-110 transition-transform",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M19 9l-7 7-7-7"})})})]})]}),N&&e.jsx("p",{className:"text-sm text-rose-400 mt-2 text-center font-medium break-words",children:N}),!N&&h==="buy"&&_>1&&e.jsxs("p",{className:"text-xs text-gray-500 mt-2 text-center break-words",children:["Minimum ",_," keys needed to follow"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-white/5 to-white/[0.02] rounded-xl p-4 sm:p-5 mb-5 border border-white/10",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 min-w-0",children:[e.jsx("span",{className:"text-base font-semibold text-white flex-shrink-0",children:h==="buy"?"You'll Pay":"You'll Receive"}),e.jsxs("span",{className:`text-xl sm:text-2xl font-bold tabular-nums truncate text-right ${w>0?h==="buy"?"text-aqua-pulse":"text-white":"text-gray-500"}`,children:[w>0&&h==="sell"?"+":"","$",w>0?(h==="buy"?K:U).toFixed(2):"0.00"]})]}),h==="buy"&&k&&w>0&&K>(((b=k.wallet)==null?void 0:b.balance_usdc)||0)/1e6&&e.jsx("p",{className:"text-xs text-rose-400 mt-2 text-center break-words",children:"Insufficient balance"})]}),e.jsx("button",{onClick:H,disabled:F||!w||w<=0,className:`w-full py-3 sm:py-4 rounded-xl font-bold text-white transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 text-sm sm:text-base shadow-lg min-w-0 ${h==="buy"?"bg-muted-green hover:bg-muted-green-light shadow-muted-green/30":"bg-rose-500 hover:bg-rose-400 shadow-rose-500/30"}`,children:F?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin flex-shrink-0"}),e.jsx("span",{className:"truncate",children:"Processing..."})]}):w>0?e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"w-5 h-5 flex-shrink-0"}),e.jsxs("span",{className:"truncate",children:[h==="buy"?"Buy":"Sell"," ",w.toFixed(2)," Key",w!==1?"s":""]})]}):e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"w-5 h-5 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:"Enter Amount"})]})})]})]}),Y())},Ft=({name:s,imageUrl:l,size:x="xl"})=>{const t={lg:"w-20 h-20 text-2xl",xl:"w-24 h-24 text-3xl","2xl":"w-32 h-32 text-4xl"},m=["bg-neon-iris/20 text-neon-iris border-neon-iris/30","bg-aqua-pulse/20 text-aqua-pulse border-aqua-pulse/30","bg-graphite-light text-moon-grey border-white/10","bg-white/10 text-white border-white/20"],o=s.charCodeAt(0)%m.length;return l?e.jsx("img",{src:l,alt:s,className:`${t[x]} rounded-full object-cover border-2 border-white/10`}):e.jsx("div",{className:`${t[x]} rounded-full ${m[o]} border-2 flex items-center justify-center font-semibold`,children:s.charAt(0).toUpperCase()})},$e=({name:s,size:l="md",imageUrl:x})=>{const t={sm:"w-8 h-8 text-xs",md:"w-10 h-10 text-sm",lg:"w-12 h-12 text-base"},m=["bg-neon-iris/20 text-neon-iris border-neon-iris/30","bg-aqua-pulse/20 text-aqua-pulse border-aqua-pulse/30","bg-graphite-light text-moon-grey border-white/10"],o=s.charCodeAt(0)%m.length;return e.jsx("div",{className:"relative flex-shrink-0",children:x?e.jsx("img",{src:x,alt:s,className:`${t[l]} rounded-full object-cover border border-white/10`}):e.jsx("div",{className:`${t[l]} rounded-full ${m[o]} border flex items-center justify-center font-semibold`,children:s.charAt(0).toUpperCase()})})},Mt=({isLiked:s,likesCount:l,commentsCount:x,onLike:t,onComment:m,onShare:o})=>e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-white/5",children:[e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsxs("button",{onClick:t,className:`flex items-center gap-2 px-4 py-2.5 rounded-xl transition-all duration-300 min-h-[44px] group ${s?"bg-brand-danger/15 text-brand-danger hover:bg-brand-danger/20":"hover:bg-white/5 text-moon-grey hover:text-brand-danger"}`,children:[e.jsx(Pe,{className:`w-5 h-5 transition-all duration-300 ${s?"scale-110 fill-current":"group-hover:scale-110"}`}),e.jsx("span",{className:"text-sm font-semibold tabular-nums",children:l})]}),e.jsxs("button",{onClick:m,className:"flex items-center gap-2 px-4 py-2.5 rounded-xl hover:bg-white/5 text-moon-grey hover:text-neon-iris transition-all min-h-[44px] group",children:[e.jsx(he,{className:"w-5 h-5 group-hover:scale-110 transition-transform duration-300"}),e.jsx("span",{className:"text-sm font-semibold tabular-nums",children:x})]})]}),e.jsx("button",{onClick:o,className:"flex items-center gap-2 px-4 py-2.5 rounded-xl hover:bg-white/5 text-moon-grey hover:text-aqua-pulse transition-all min-h-[44px] group",children:e.jsx(it,{className:"w-5 h-5 group-hover:scale-110 transition-transform duration-300"})})]}),Lt=({postId:s,isOpen:l,onReplyCreated:x})=>{const[t,m]=d.useState([]),[o,f]=d.useState(new Map),[_,T]=d.useState(new Set),[M,k]=d.useState(new Set),[h,L]=d.useState(!1),[S,P]=d.useState(""),[F,B]=d.useState(!1),[N,j]=d.useState(null),R=d.useRef(null);d.useEffect(()=>{l&&A()},[l,s]);const A=async()=>{L(!0);try{const{comments:n}=await Xe(s,{limit:50});m(n)}catch(n){console.error("Failed to load comments:",n)}finally{L(!1)}},w=async n=>{if(!(o.has(n)||M.has(n))){k(a=>new Set(a).add(n));try{const{replies:a}=await et(n,{limit:50});f(p=>{const u=new Map(p);return u.set(n,a),u})}catch(a){console.error("Failed to load replies:",a)}finally{k(a=>{const p=new Set(a);return p.delete(n),p})}}},K=n=>{_.has(n)?T(a=>{const p=new Set(a);return p.delete(n),p}):(T(a=>new Set(a).add(n)),w(n))},U=async()=>{var n,a;if(!(!S.trim()||F)){B(!0);try{await Ze({post_id:s,content:S.trim(),parent_comment_id:(N==null?void 0:N.id)||void 0}),P(""),j(null),A(),N!=null&&N.id&&(f(p=>{const u=new Map(p);return u.delete(N.id),u}),w(N.id)),x(),y.success("Reply posted!")}catch(p){y.error(((a=(n=p.response)==null?void 0:n.data)==null?void 0:a.error)||"Failed to post reply")}finally{B(!1)}}},H=(n,a,p)=>{var g;const u=a||p;j({id:n,name:u}),P(`@${u} `),(g=R.current)==null||g.focus()},Y=async n=>{var a,p;try{const u=await tt(n);m(g=>g.map($=>$.id===n?{...$,is_liked:u.liked,likes_count:u.likes_count}:$)),f(g=>{const $=new Map(g);for(const[D,X]of $.entries()){const I=X.map(W=>W.id===n?{...W,is_liked:u.liked,likes_count:u.likes_count}:W);$.set(D,I)}return $})}catch(u){y.error(((p=(a=u.response)==null?void 0:a.data)==null?void 0:p.error)||"Failed to like comment")}},z=(n,a,p=[])=>{for(const u of n){p.push({comment:u,parent:a,depth:a?1:0});const g=o.get(u.id);g&&_.has(u.id)&&z(g,u,p)}return p},b=n=>{const{comment:a,parent:p,depth:u}=n,g=o.get(a.id),$=o.has(a.id),D=g&&g.length>0,X=_.has(a.id),I=!!p;return e.jsxs("div",{className:`relative pr-3 py-3 hover:bg-graphite-light transition-colors border-b border-white/5 last:border-b-0 ${I?"pl-12 ml-8":"pl-3"}`,children:[I&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-px bg-white/10"}),e.jsx("div",{className:"absolute left-0 top-[18px] w-8 h-px bg-white/10"})]}),e.jsxs("div",{className:"flex gap-3 relative",children:[e.jsx("div",{className:"flex-shrink-0 relative",children:e.jsx($e,{name:a.display_name||a.username,size:"sm",imageUrl:a.avatar_url||void 0})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[p&&e.jsx("div",{className:"mb-1.5",children:e.jsxs("span",{className:"text-xs text-moon-grey-dark",children:["Replying to"," ",e.jsx("span",{className:"font-medium text-moon-grey",children:p.display_name||p.username})]})}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"font-semibold text-sm text-white",children:a.display_name||a.username}),u===0&&e.jsxs("span",{className:"text-xs text-moon-grey-dark",children:["@",a.username]}),e.jsx("span",{className:"text-xs text-moon-grey-dark",children:a.created_at?re(Number(a.created_at)):"now"})]}),e.jsx("p",{className:"text-sm text-moon-grey-light mt-1 whitespace-pre-wrap leading-relaxed",children:a.content}),e.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[e.jsxs("button",{onClick:()=>Y(a.id),className:`flex items-center gap-1.5 text-xs transition-colors font-medium ${a.is_liked?"text-brand-danger hover:text-brand-danger/80":"text-moon-grey-dark hover:text-brand-danger"}`,children:[e.jsx(Pe,{className:`w-3.5 h-3.5 ${a.is_liked?"fill-current":""}`}),a.likes_count!==void 0&&a.likes_count>0?a.likes_count:""]}),e.jsx("button",{onClick:()=>H(a.id,a.display_name,a.username),className:"text-xs text-moon-grey-dark hover:text-neon-iris transition-colors font-medium",children:"Reply"}),e.jsx("button",{onClick:()=>K(a.id),className:"text-xs text-moon-grey-dark hover:text-neon-iris transition-colors font-medium",children:X?"Hide replies":$&&D?`${g.length} ${g.length===1?"reply":"replies"}`:$&&!D?"No replies":"View replies"})]})]})]})]},a.id)};return l?e.jsxs("div",{className:"border-t border-white/5 bg-graphite-deep",children:[e.jsxs("div",{className:"p-5 border-b border-white/5",children:[N&&e.jsxs("div",{className:"mb-3 px-3 py-2 bg-graphite-light border border-white/10 rounded-lg flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx("span",{className:"text-moon-grey-dark",children:"Replying to"}),e.jsx("span",{className:"text-neon-iris font-semibold",children:N.name})]}),e.jsx("button",{onClick:()=>{j(null),P("")},className:"p-1 rounded-lg hover:bg-graphite-hover text-moon-grey hover:text-white transition-all",children:e.jsx(se,{className:"w-3.5 h-3.5"})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("textarea",{ref:R,value:S,onChange:n=>P(n.target.value),onKeyDown:n=>{n.key==="Enter"&&!n.shiftKey&&(n.preventDefault(),U())},placeholder:N?`Reply to ${N.name}...`:"Write a reply...",rows:S.split(`
`).length+1,className:"w-full bg-graphite-light border border-white/10 rounded-lg px-4 py-3 text-sm text-white placeholder-moon-grey-dark focus:outline-none focus:ring-2 focus:ring-neon-iris/30 focus:border-neon-iris/50 focus:bg-graphite-hover transition-all resize-none min-h-[44px] max-h-32 leading-relaxed"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Press Enter to reply, Shift+Enter for new line"}),e.jsx("button",{onClick:U,disabled:!S.trim()||F,className:"px-5 py-2 rounded-lg bg-neon-iris text-white text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed hover:bg-neon-iris-light transition-all flex items-center gap-2",children:F?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-3.5 h-3.5 border-2 border-white/30 border-t-white rounded-full animate-spin"}),e.jsx("span",{children:"Posting..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(he,{className:"w-4 h-4"}),e.jsx("span",{children:"Reply"})]})})]})]})]}),e.jsx("div",{className:"max-h-96 overflow-y-auto",children:h?e.jsx("div",{className:"p-5 text-center text-moon-grey-dark text-sm",children:"Loading comments..."}):t.length===0?e.jsx("div",{className:"p-5 text-center text-moon-grey-dark text-sm",children:"No replies yet"}):e.jsx("div",{children:z(t).map(n=>e.jsx("div",{children:b(n)},n.comment.id))})})]}):null},Rt=({post:s,onLike:l,onToggleReplies:x,showReplies:t,onReplyCreated:m,profile:o,onImageClick:f})=>{const _=async()=>{try{await navigator.clipboard.writeText(window.location.origin+`/post/${s.id}`),y.success("Link copied!")}catch{y.error("Failed to copy link")}};return e.jsxs("article",{className:"bg-graphite-deep border border-white/5 rounded-lg transition-all duration-200 hover:border-white/10",children:[e.jsx("div",{className:"p-5 pb-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx($e,{name:o.display_name||o.username,size:"md",imageUrl:o.avatar_url||void 0})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"font-semibold text-white text-[15px]",children:o.display_name||o.username}),o.total_pnl>1e4&&e.jsx("span",{className:"px-2 py-0.5 text-xs font-semibold bg-neon-iris/20 text-neon-iris border border-neon-iris/30 rounded",children:"VIP"}),e.jsx("span",{className:"text-gray-500",children:"Â·"}),e.jsx("span",{className:"text-xs text-gray-500",children:s.created_at?re(Number(s.created_at)):"now"})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-0.5",children:["@",o.username.length>10?o.username.substring(0,10)+"...":o.username]})]}),e.jsx("button",{className:"p-2 rounded-xl hover:bg-white/5 text-moon-grey-dark hover:text-white transition-all min-w-[40px] min-h-[40px] flex items-center justify-center",children:e.jsx(mt,{className:"w-5 h-5"})})]})}),s.market_question&&e.jsxs(xe,{to:`/market/${s.market_id}`,className:"mx-5 mb-4 flex items-center gap-2.5 px-3 py-2 bg-graphite-light border border-white/10 rounded-lg transition-all group hover:border-neon-iris/30",children:[e.jsx(te,{className:"w-4 h-4 text-neon-iris flex-shrink-0"}),e.jsx("span",{className:"text-sm text-moon-grey-light group-hover:text-white line-clamp-1 font-medium flex-1",children:s.market_question}),e.jsx("svg",{className:"w-4 h-4 text-moon-grey ml-auto flex-shrink-0 group-hover:text-neon-iris group-hover:translate-x-0.5 transition-transform",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]}),e.jsx("div",{className:"px-5 pb-4 relative",children:e.jsx("p",{className:"text-white leading-relaxed whitespace-pre-wrap text-sm",children:s.content})}),s.image_url&&e.jsx("div",{className:"relative mx-5 mb-4 rounded-lg overflow-hidden border border-white/10",children:e.jsx("img",{src:s.image_url,alt:"Post attachment",loading:"lazy",className:"w-full max-h-[500px] object-cover max-w-full cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>f==null?void 0:f(s.image_url)})}),s.video_url&&e.jsx("div",{className:"relative mx-5 mb-4 rounded-lg overflow-hidden border border-white/10 bg-graphite-light",onClick:T=>T.stopPropagation(),children:e.jsx("video",{src:s.video_url,controls:!0,className:"w-full max-h-[500px] object-contain max-w-full",preload:"metadata",children:"Your browser does not support the video tag."})}),e.jsx("div",{className:"px-5 pb-4",children:e.jsx(Mt,{isLiked:s.is_liked||!1,likesCount:s.likes_count,commentsCount:s.comments_count,onLike:l,onComment:x,onShare:_})}),e.jsxs("button",{onClick:x,className:"w-full px-5 py-3 bg-graphite-light border-t border-white/5 text-sm text-moon-grey hover:text-white hover:bg-graphite-hover transition-all flex items-center gap-2 font-medium",children:[e.jsx(he,{className:"w-4 h-4 text-neon-iris"}),t?"Hide replies":s.comments_count>0?`View ${s.comments_count} ${s.comments_count===1?"reply":"replies"}`:"Reply"]}),e.jsx(Lt,{postId:s.id,isOpen:t,onReplyCreated:m})]})},Kt=({activeTab:s,onTabChange:l,postsCount:x,showTradesTab:t})=>{const m=[{id:"posts",label:"Posts",count:x},{id:"markets",label:"Markets"},...t?[{id:"trades",label:"Trades"}]:[]];return e.jsx("div",{className:"flex border-b border-white/10 gap-1 overflow-x-auto -mx-4 sm:mx-0 px-4 sm:px-0",children:m.map(o=>e.jsxs("button",{onClick:()=>l(o.id),className:`px-4 sm:px-6 py-3.5 text-sm font-medium transition-all relative whitespace-nowrap flex items-center gap-2 ${s===o.id?"text-white":"text-moon-grey hover:text-white"}`,children:[e.jsx("span",{children:o.label}),o.count!==void 0&&e.jsx("span",{className:`text-xs px-1.5 py-0.5 rounded-full ${s===o.id?"bg-neon-iris/20 text-neon-iris":"bg-white/5 text-moon-grey-dark"}`,children:o.count}),s===o.id&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-neon-iris rounded-t-full"})]},o.id))})},ce=({icon:s,title:l,subtitle:x})=>e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 px-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-graphite-deep border border-white/10 flex items-center justify-center mb-4",children:e.jsx(s,{className:"w-8 h-8 text-moon-grey"})}),e.jsx("h3",{className:"text-lg font-semibold text-white mb-1",children:l}),e.jsx("p",{className:"text-moon-grey-dark text-sm text-center",children:x})]}),Et=()=>e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-32 bg-graphite-deep border-b border-white/5"}),e.jsxs("div",{className:"px-4 -mt-12",children:[e.jsx("div",{className:"w-24 h-24 rounded-full bg-graphite-light mb-4"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-6 w-40 bg-graphite-light rounded"}),e.jsx("div",{className:"h-4 w-24 bg-graphite-light rounded"}),e.jsx("div",{className:"h-4 w-full bg-graphite-light rounded"})]})]})]}),Tt=()=>e.jsxs("div",{className:"bg-graphite-deep border border-white/5 rounded-lg animate-pulse",children:[e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsx("div",{className:"h-3 w-32 bg-graphite-light rounded"}),e.jsx("div",{className:"h-4 w-full bg-graphite-light rounded"}),e.jsx("div",{className:"h-4 w-3/4 bg-graphite-light rounded"})]}),e.jsx("div",{className:"h-48 bg-graphite-light"})]}),At=({market:s,onImageClick:l})=>{const x=me();let t=[];if(s.is_binary&&s.options&&s.options.length>0){const m=s.options[0],o=m.yes_price??.5,f=m.no_price??1-o;t=[{option:m,side:"yes",price:o},{option:m,side:"no",price:f}]}else s.options&&s.options.length>0&&(t=s.options.slice(0,2).map(m=>({option:m,side:"other",price:m.yes_price??.5})));return e.jsx("article",{className:"px-4 py-3 hover:bg-white/[0.02] transition-colors cursor-pointer border-b border-white/5",onClick:()=>x(`/market/${s.id}`),children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-10 h-10 rounded-full bg-graphite-light border border-white/10 flex items-center justify-center",children:e.jsx(ct,{className:"w-5 h-5 text-neon-iris"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-0.5",children:[e.jsx("span",{className:"text-[15px] font-semibold text-white",children:"Created market"}),e.jsx("span",{className:"text-gray-500",children:"Â·"}),e.jsx("span",{className:"text-[15px] text-gray-500",children:s.created_at?re(Number(s.created_at)):"now"})]}),e.jsx("p",{className:"text-[15px] text-white leading-5 mb-3",children:s.question}),e.jsxs("div",{className:"flex gap-3 mb-2",children:[s.image_url&&e.jsx("div",{className:"flex-shrink-0 w-24 h-24 rounded-xl overflow-hidden cursor-pointer hover:opacity-90 transition-opacity",onClick:m=>{m.stopPropagation(),l==null||l(s.image_url)},children:e.jsx("img",{src:s.image_url,alt:"",className:"w-full h-full object-cover",loading:"lazy"})}),t.length>0&&e.jsxs("div",{className:"flex-1 flex flex-col gap-1.5 min-w-0",children:[t.map((m,o)=>{const{option:f,side:_,price:T}=m,M=_==="yes",k=_==="no",h=M?"Yes":k?"No":f.option_label;return e.jsxs("div",{className:`flex items-center gap-2 px-2 py-1.5 rounded-lg hover:bg-graphite-light transition-colors border ${M?"bg-muted-green/10 border-muted-green/20":k?"bg-brand-danger/10 border-brand-danger/20":"bg-graphite-light border-white/10"}`,onClick:L=>{L.stopPropagation(),x(`/market/${s.id}`)},children:[f.option_image_url?e.jsx("img",{src:f.option_image_url,alt:"",className:"w-4 h-4 rounded object-cover flex-shrink-0"}):e.jsx("div",{className:`w-4 h-4 rounded flex-shrink-0 ${M?"bg-muted-green/20":k?"bg-rose-500/20":"bg-white/10"}`}),e.jsx("span",{className:`text-[13px] flex-1 truncate font-medium ${M?"text-muted-green":k?"text-brand-danger":"text-white"}`,children:h}),e.jsxs("span",{className:"text-[13px] text-moon-grey-dark flex-shrink-0",children:[(T*100).toFixed(0),"Â¢"]})]},`${f.id}-${_}-${o}`)}),!s.is_binary&&s.options&&s.options.length>2&&e.jsx("div",{className:"px-2 py-1",children:e.jsxs("span",{className:"text-[13px] text-gray-500",children:["+",s.options.length-2," more"]})})]})]})]})]})})},Yt=({trade:s})=>{const l=me(),x=s.action==="buy",t=s.side==="yes";return e.jsx("article",{className:"relative px-4 py-3 hover:bg-white/[0.02] transition-colors cursor-pointer border-b border-white/5",onClick:()=>s.market_id&&l(`/market/${s.market_id}`),children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"flex-shrink-0 mt-0.5",children:e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${x?"bg-aqua-pulse/20 text-aqua-pulse":"bg-brand-danger/20 text-brand-danger"}`,children:x?e.jsx(at,{className:"w-5 h-5"}):e.jsx(nt,{className:"w-5 h-5"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1 flex-wrap",children:[e.jsx("span",{className:`text-sm font-semibold ${x?"text-aqua-pulse":"text-brand-danger"}`,children:x?"Bought":"Sold"}),e.jsx("span",{className:"text-gray-500",children:"Â·"}),e.jsx("span",{className:"text-xs text-gray-500",children:s.created_at?re(Number(s.created_at)):"now"})]}),s.market_question&&e.jsx("p",{className:"text-white text-sm mb-2 line-clamp-2 leading-relaxed",children:s.market_question}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx("span",{className:`inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium ${t?"bg-muted-green/20 text-muted-green":"bg-rose-500/20 text-rose-400"}`,children:s.option_label||(t?"Yes":"No")}),e.jsxs("span",{className:"text-sm text-gray-400",children:[(s.shares/1e6).toFixed(2)," shares"]}),s.pricePerShare!==void 0&&e.jsxs("span",{className:"text-sm text-gray-400",children:["@ $",(s.pricePerShare*100).toFixed(2)]}),s.amount&&e.jsxs("span",{className:`text-sm font-semibold ml-auto ${x?"text-aqua-pulse":"text-brand-danger"}`,children:[x?"+":"-","$",(Math.abs(s.amount)/1e6).toFixed(2)]})]}),s.market_id&&e.jsxs("div",{className:"mt-2 flex items-center gap-1 text-xs text-gray-500 hover:text-neon-iris transition-colors",children:[e.jsx("span",{children:"View market"}),e.jsx(ut,{className:"w-3 h-3"})]})]})]})})},It=()=>{const{identifier:s}=Be(),{user:l}=Ce(),x=me(),[t,m]=d.useState(null),[o,f]=d.useState([]),[_,T]=d.useState([]),[M,k]=d.useState([]),[h,L]=d.useState("posts"),[S,P]=d.useState(!0),[F,B]=d.useState(!0),[N,j]=d.useState(!1),[R,A]=d.useState(!1),[w,K]=d.useState(!1),[U,H]=d.useState(!1),[Y,z]=d.useState(null),[b,n]=d.useState(0),[a,p]=d.useState(!1),[u,g]=d.useState(1),[$,D]=d.useState(!1),[X,I]=d.useState(!1);d.useEffect(()=>{if(t!=null&&t.required_keys_to_follow){const r=t.required_keys_to_follow,i=Math.max(1,r-b);g(i)}},[t==null?void 0:t.required_keys_to_follow,b]);const[W,ue]=d.useState(new Set),[Q,ge]=d.useState(""),[G,ae]=d.useState(null),[ne,ie]=d.useState(null),[pe,be]=d.useState(!1),[we,le]=d.useState(null),C=(l==null?void 0:l.id)===s||(l==null?void 0:l.username)===s;d.useEffect(()=>{s&&(qe(),oe())},[s]),d.useEffect(()=>{t!=null&&t.id&&Z()},[t==null?void 0:t.id,t==null?void 0:t.keys_supply,C]),d.useEffect(()=>{t!=null&&t.id&&ye()},[t==null?void 0:t.id]),d.useEffect(()=>{s&&h==="trades"&&(C||(t==null?void 0:t.required_keys_to_follow)===0||t!=null&&t.required_keys_to_follow&&b>=t.required_keys_to_follow)&&fe()},[s,h,C,t==null?void 0:t.required_keys_to_follow,b]),d.useEffect(()=>{s&&h==="markets"&&(t!=null&&t.id)&&Me()},[s,h,t==null?void 0:t.id]);const qe=async()=>{if(s){P(!0);try{const r=await Ue.get(`/user/profile/${s}`);m(r.data.user)}catch(r){console.error("Failed to load profile:",r),y.error("Failed to load profile")}finally{P(!1)}}},ye=async()=>{if(t!=null&&t.id){B(!0);try{const{posts:r}=await ze(t.id);f(r)}catch(r){console.error("Failed to load posts:",r)}finally{B(!1)}}},Z=async()=>{if(t!=null&&t.id){p(!0);try{const[r,i]=await Promise.all([De(t.id),C?Promise.resolve({quantity:t.keys_supply||0}):Ie(t.id)]);z(r.price_in_usdc);const c=typeof i.quantity=="number"?i.quantity:parseFloat(String(i.quantity))||0;n(c)}catch(r){console.error("Failed to load key info:",r)}finally{p(!1)}}},fe=async()=>{var r,i;if(s){j(!0);try{const c=(t==null?void 0:t.id)||s,{trades:v}=await Ve(c,{page:1,limit:50});T(v)}catch(c){if(console.error("Failed to load trades:",c),((r=c.response)==null?void 0:r.status)===403){const v=(i=c.response)==null?void 0:i.data;(v==null?void 0:v.required_keys)!==void 0?y.error(`You need at least ${v.required_keys} key(s) to view trades. You have ${v.owned_keys||0}.`):y.error("You must have access to view this user's trades")}else y.error("Failed to load trades")}finally{j(!1)}}},Fe=async()=>{var r,i;if(!(!(t!=null&&t.id)||$)){D(!0);try{const c=await _e({trader_id:t.id,quantity:u});if(y.success(`Successfully purchased ${c.quantity} key(s)`),await Z(),t.required_keys_to_follow&&c.quantity+b>=t.required_keys_to_follow&&await fe(),b===0&&c.quantity>=1&&!w)try{await de(t.id),K(!0),await oe()}catch(v){console.error("Auto-follow failed:",v)}}catch(c){console.error("Failed to buy keys:",c),y.error(((i=(r=c.response)==null?void 0:r.data)==null?void 0:i.message)||"Failed to buy keys")}finally{D(!1)}}},Me=async()=>{if(t!=null&&t.id){A(!0);try{const{markets:r}=await He({creator:t.id,page:1,limit:50});k(r)}catch(r){console.error("Failed to load markets:",r),y.error("Failed to load markets")}finally{A(!1)}}},oe=async()=>{if(!(!s||!l||C))try{const r=(t==null?void 0:t.id)||s,{is_following:i}=await We(r);K(i)}catch(r){console.error("Failed to check follow status:",r)}},Le=async()=>{var i,c,v,ee,O,ve;if(!s||U)return;const r=(t==null?void 0:t.required_keys_to_follow)||1;if(!w&&b<r){y.error(`You must purchase at least ${r} key(s) to follow this user. You currently have ${b}.`),h!=="trades"&&L("trades");return}H(!0);try{const V=(t==null?void 0:t.id)||s;w?(await Ge(V),K(!1),m(q=>q?{...q,followers_count:q.followers_count-1}:null),y.success("Unfollowed")):(await de(V),K(!0),m(q=>q?{...q,followers_count:q.followers_count+1}:null),y.success("Following! ðŸŽ‰"))}catch(V){if(((i=V.response)==null?void 0:i.status)===403){const q=(c=V.response)==null?void 0:c.data;(q==null?void 0:q.required_keys)!==void 0?(y.error(`You need to purchase at least ${q.required_keys} key(s) to follow this user. You currently have ${q.owned_keys||0} key(s).`),h!=="trades"&&L("trades")):y.error(((ee=(v=V.response)==null?void 0:v.data)==null?void 0:ee.message)||"You must purchase keys to follow this user")}else y.error(((ve=(O=V.response)==null?void 0:O.data)==null?void 0:ve.error)||"Action failed")}finally{H(!1)}},Re=async r=>{var i,c;try{const v=await Je(r);f(ee=>ee.map(O=>O.id===r?{...O,is_liked:v.liked,likes_count:v.likes_count}:O))}catch(v){y.error(((c=(i=v.response)==null?void 0:i.data)==null?void 0:c.error)||"Failed to like post")}},Ke=r=>{W.has(r)?ue(i=>{const c=new Set(i);return c.delete(r),c}):ue(i=>new Set(i).add(r))},Ee=r=>{f(i=>i.map(c=>c.id===r?{...c,comments_count:c.comments_count+1}:c))},je=r=>{var v;const i=(v=r.target.files)==null?void 0:v[0];if(!i)return;if(!i.type.startsWith("image/")&&!i.type.startsWith("video/")){y.error("Please select an image or video file");return}if(i.size>100*1024*1024){y.error("File size must be less than 100MB");return}ae(i);const c=new FileReader;c.onloadend=()=>{ie(c.result)},c.readAsDataURL(i)},Te=()=>{ae(null),ie(null)},Ae=async()=>{var r,i;if(!Q.trim()&&!G){y.error("Please add some content or media");return}if(!l){y.error("Please log in to create a post");return}be(!0);try{await Oe({content:Q.trim()||"",media:G||void 0}),ge(""),ae(null),ie(null),await ye(),y.success("Post created!")}catch(c){console.error("Failed to create post:",c),y.error(((i=(r=c.response)==null?void 0:r.data)==null?void 0:i.error)||"Failed to create post")}finally{be(!1)}};return S?e.jsx("div",{className:"min-h-screen pb-20",children:e.jsx(Et,{})}):t?e.jsxs("div",{className:"min-h-screen pb-20 md:pb-8 bg-ink-black",children:[e.jsxs("div",{className:"h-32 sm:h-36 md:h-40 bg-gradient-to-b from-graphite-deep to-ink-black border-b border-white/5 relative",children:[e.jsx("button",{onClick:()=>x(-1),className:"absolute top-4 left-4 sm:top-5 sm:left-5 p-2.5 rounded-xl bg-graphite-deep/90 backdrop-blur-md text-moon-grey hover:text-white hover:bg-graphite-light border border-white/10 transition-all min-w-[44px] min-h-[44px] flex items-center justify-center shadow-lg","aria-label":"Go back",children:e.jsx(st,{className:"w-5 h-5"})}),C&&e.jsx(xe,{to:"/settings",className:"absolute top-4 right-4 sm:top-5 sm:right-5 p-2.5 rounded-xl bg-graphite-deep/90 backdrop-blur-md text-moon-grey hover:text-white hover:bg-graphite-light border border-white/10 transition-all min-w-[44px] min-h-[44px] flex items-center justify-center shadow-lg","aria-label":"Settings",children:e.jsx(Ne,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"relative max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-6 lg:gap-8 -mt-12 mb-6 sm:mb-8",children:[e.jsx("div",{className:"flex-shrink-0 self-start",children:e.jsx(Ft,{name:t.display_name||t.username,imageUrl:t.avatar_url,size:"xl"})}),e.jsxs("div",{className:"flex-1 min-w-0 space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2.5 flex-wrap",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl lg:text-4xl font-bold text-white break-words leading-tight",children:t.display_name||t.username}),t.total_trades>100&&e.jsx("span",{title:"Verified trader",className:"flex-shrink-0",children:e.jsx(ot,{className:"w-5 h-5 sm:w-6 sm:h-6 text-neon-iris"})})]}),e.jsxs("p",{className:"text-moon-grey text-sm sm:text-base",children:["@",t.username.length>10?t.username.substring(0,10)+"...":t.username]}),t.created_at&&e.jsxs("p",{className:"text-moon-grey text-xs sm:text-sm",children:["Joined"," ",(()=>{const r=Number(t.created_at),i=new Date(r>1e11?r:r*1e3);return isNaN(i.getTime())?"recently":i.toLocaleDateString("en-US",{month:"long",year:"numeric"})})()]})]}),t.bio&&e.jsx("p",{className:"text-moon-grey-light text-sm sm:text-base leading-relaxed break-words max-w-2xl",children:t.bio}),e.jsxs("div",{className:"flex items-center gap-4 sm:gap-6 text-sm flex-wrap",children:[e.jsxs("button",{className:"hover:text-white transition-colors group",children:[e.jsx("span",{className:"font-semibold text-white tabular-nums group-hover:text-neon-iris transition-colors",children:t.followers_count.toLocaleString()}),e.jsx("span",{className:"text-moon-grey ml-1.5",children:"Followers"})]}),e.jsxs("button",{className:"hover:text-white transition-colors group",children:[e.jsx("span",{className:"font-semibold text-white tabular-nums group-hover:text-neon-iris transition-colors",children:(t.keys_supply||0).toLocaleString()}),e.jsx("span",{className:"text-moon-grey ml-1.5",children:"Keys"})]}),l&&b>0&&e.jsxs("button",{className:"hover:text-white transition-colors group",children:[e.jsx("span",{className:"font-semibold text-white tabular-nums group-hover:text-neon-iris transition-colors",children:b.toFixed(2)}),e.jsx("span",{className:"text-moon-grey ml-1.5",children:"Owned"})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2.5 sm:gap-3 pt-1",children:[!C&&l&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>I(!0),className:"px-4 py-2.5 rounded-lg font-medium text-sm transition-all border bg-muted-green text-white border-muted-green hover:bg-muted-green-light hover:border-muted-green-light flex items-center gap-2 shadow-lg shadow-muted-green/20",children:[e.jsx(J,{className:"w-4 h-4"}),Y!==null?`$${Y.toFixed(4)}`:"View Keys"]}),e.jsx("button",{onClick:Le,disabled:U||b<((t==null?void 0:t.required_keys_to_follow)||1)&&!w,className:`px-4 py-2.5 rounded-lg font-medium text-sm transition-all border flex items-center gap-2 ${w?"bg-graphite-deep text-white border-white/10 hover:bg-graphite-light":b<((t==null?void 0:t.required_keys_to_follow)||1)?"bg-white/5 text-gray-400 border-white/5 cursor-not-allowed":"bg-muted-green text-white border-muted-green hover:bg-muted-green-light shadow-lg shadow-muted-green/20"}`,title:b<((t==null?void 0:t.required_keys_to_follow)||1)&&!w?`Purchase at least ${(t==null?void 0:t.required_keys_to_follow)||1} key(s) to follow`:"",children:U?e.jsx("span",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}):w?"Following":b<((t==null?void 0:t.required_keys_to_follow)||1)?`Buy ${(t==null?void 0:t.required_keys_to_follow)||1} Key${((t==null?void 0:t.required_keys_to_follow)||1)>1?"s":""} to Follow`:"Follow"}),!w&&b<((t==null?void 0:t.required_keys_to_follow)||1)&&e.jsxs("div",{className:"text-xs text-gray-400 flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg bg-white/5 border border-white/5",children:[e.jsx(J,{className:"w-3 h-3"}),e.jsxs("span",{children:[b.toFixed(2)," /"," ",(t==null?void 0:t.required_keys_to_follow)||1," required"]})]})]}),C&&e.jsxs(xe,{to:"/settings",className:"px-4 py-2.5 rounded-lg bg-graphite-deep text-white font-medium text-sm hover:bg-graphite-light border border-white/10 transition-all flex items-center gap-2",children:[e.jsx(Ne,{className:"w-4 h-4"}),"Edit Profile"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3 sm:gap-4 mb-6 sm:mb-8",children:[e.jsx("div",{className:"bg-graphite-deep border border-white/5 rounded-xl p-4 sm:p-5 hover:border-white/10 transition-all group",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"p-2.5 rounded-lg bg-neon-iris/10 group-hover:bg-neon-iris/20 transition-colors",children:e.jsx(te,{className:"w-4 h-4 sm:w-5 sm:h-5 text-neon-iris"})}),e.jsx("div",{className:"text-xs text-moon-grey-dark uppercase tracking-wider font-medium",children:"Total Trades"})]}),e.jsx("div",{className:"text-2xl sm:text-3xl font-bold text-white tabular-nums",children:t.total_trades.toLocaleString()})]})})}),e.jsx("div",{className:"bg-graphite-deep border border-white/5 rounded-xl p-4 sm:p-5 hover:border-white/10 transition-all group",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"p-2.5 rounded-lg bg-aqua-pulse/10 group-hover:bg-aqua-pulse/20 transition-colors",children:e.jsx(te,{className:"w-4 h-4 sm:w-5 sm:h-5 text-aqua-pulse"})}),e.jsx("div",{className:"text-xs text-moon-grey-dark uppercase tracking-wider font-medium",children:"Total Volume"})]}),e.jsxs("div",{className:"text-2xl sm:text-3xl font-bold text-white tabular-nums",children:["$",(t.total_trades*100).toLocaleString()]})]})})}),e.jsx("div",{className:"bg-graphite-deep border border-white/5 rounded-xl p-4 sm:p-5 hover:border-white/10 transition-all group",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:`p-2.5 rounded-lg transition-colors ${t.total_pnl>=0?"bg-aqua-pulse/10 group-hover:bg-aqua-pulse/20":"bg-brand-danger/10 group-hover:bg-brand-danger/20"}`,children:t.total_pnl>=0?e.jsx(ke,{className:"w-4 h-4 sm:w-5 sm:h-5 text-aqua-pulse"}):e.jsx(rt,{className:"w-4 h-4 sm:w-5 sm:h-5 text-brand-danger"})}),e.jsx("div",{className:"text-xs text-moon-grey-dark uppercase tracking-wider font-medium",children:"Total P&L"})]}),e.jsxs("div",{className:`text-2xl sm:text-3xl font-bold tabular-nums ${t.total_pnl>=0?"text-aqua-pulse":"text-brand-danger"}`,children:[t.total_pnl>=0?"+":"","$",Math.abs(t.total_pnl).toLocaleString()]})]})})})]}),e.jsx(Kt,{activeTab:h,onTabChange:L,postsCount:t.posts_count,showTradesTab:w||C}),e.jsxs("div",{className:"py-6 sm:py-8",children:[h==="posts"&&e.jsxs(e.Fragment,{children:[C&&e.jsxs("div",{className:"mb-6 bg-graphite-deep border border-white/5 rounded-xl p-5 sm:p-6",children:[e.jsx("textarea",{value:Q,onChange:r=>ge(r.target.value),placeholder:"Share your trading insights...",className:"w-full bg-graphite-light border border-white/10 rounded-lg px-4 py-3 text-white placeholder-moon-grey-dark focus:outline-none focus:ring-2 focus:ring-neon-iris/30 focus:border-neon-iris/50 focus:bg-graphite-hover resize-none transition-all text-sm leading-relaxed min-h-[100px]",rows:4,maxLength:5e3}),Q.length>0&&e.jsxs("div",{className:"mt-2 text-xs text-moon-grey-dark text-right",children:[Q.length,"/5000"]}),ne&&e.jsxs("div",{className:"relative mt-4 rounded-lg overflow-hidden border border-white/10 bg-graphite-light",children:[G!=null&&G.type.startsWith("image/")?e.jsx("img",{src:ne,alt:"Preview",className:"w-full max-h-80 object-cover"}):e.jsx("video",{src:ne,controls:!0,className:"w-full max-h-80 object-contain bg-graphite-light"}),e.jsx("button",{onClick:Te,className:"absolute top-3 right-3 p-2 bg-graphite-deep/90 backdrop-blur-sm rounded-lg hover:bg-graphite-deep border border-white/10 transition-all",children:e.jsx(se,{className:"w-4 h-4 text-white"})})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4 pt-4 border-t border-white/5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("label",{className:"cursor-pointer group relative",children:[e.jsx("div",{className:"p-2 rounded-lg hover:bg-graphite-light transition-all",children:e.jsx(yt,{className:"w-4 h-4 text-moon-grey group-hover:text-neon-iris transition-colors"})}),e.jsx("input",{type:"file",accept:"image/*,video/*",onChange:je,className:"hidden"})]}),e.jsxs("label",{className:"cursor-pointer group relative",children:[e.jsx("div",{className:"p-2 rounded-lg hover:bg-graphite-light transition-all",children:e.jsx(_t,{className:"w-4 h-4 text-moon-grey group-hover:text-aqua-pulse transition-colors"})}),e.jsx("input",{type:"file",accept:"video/*",onChange:je,className:"hidden"})]})]}),e.jsx("button",{onClick:Ae,disabled:pe||!Q.trim()&&!G,className:"px-5 py-2 bg-neon-iris text-white rounded-lg font-medium text-sm min-w-[100px] disabled:opacity-40 disabled:cursor-not-allowed hover:bg-neon-iris-light transition-all",children:pe?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Posting..."]}):"Post"})]})]}),F?e.jsx("div",{className:"space-y-5",children:Array.from({length:3}).map((r,i)=>e.jsx(Tt,{},i))}):o.length===0?e.jsx(ce,{icon:pt,title:"No posts yet",subtitle:C?"Share your first post":"This user hasn't posted yet"}):e.jsx("div",{className:"space-y-5",children:o.map((r,i)=>e.jsx("div",{style:{animationDelay:`${i*.05}s`},className:"animate-fade-in-up",children:e.jsx(Rt,{post:r,onLike:()=>Re(r.id),onToggleReplies:()=>Ke(r.id),showReplies:W.has(r.id),onReplyCreated:()=>Ee(r.id),profile:t,onImageClick:c=>le(c)})},r.id))})]}),h==="markets"&&e.jsx(e.Fragment,{children:R?e.jsx("div",{className:"border-t border-white/10",children:Array.from({length:5}).map((r,i)=>e.jsx("div",{className:"px-4 py-3 border-b border-white/5 animate-pulse",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-white/10 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-4 w-24 bg-white/10 rounded"}),e.jsx("div",{className:"h-4 w-full bg-white/10 rounded"}),e.jsx("div",{className:"h-3 w-32 bg-white/10 rounded"})]})]})},i))}):M.length===0?e.jsx("div",{className:"border-t border-white/10 py-16",children:e.jsx(ce,{icon:te,title:"No markets",subtitle:C?"Create your first prediction market":"This user hasn't created any markets"})}):e.jsx("div",{className:"border-t border-white/10",children:M.map((r,i)=>e.jsx("div",{style:{animationDelay:`${i*.05}s`},className:"animate-fade-in-up",children:e.jsx(At,{market:r,onImageClick:c=>le(c)})},r.id))})}),h==="trades"&&e.jsx(e.Fragment,{children:!C&&((t==null?void 0:t.required_keys_to_follow)||1)>0&&b<((t==null?void 0:t.required_keys_to_follow)||1)?e.jsx("div",{className:"border-t border-white/10 py-16 sm:py-20",children:e.jsxs("div",{className:"flex flex-col items-center justify-center text-center px-4 max-w-md mx-auto",children:[e.jsx("div",{className:"w-20 h-20 rounded-2xl bg-neon-iris/10 border border-neon-iris/20 flex items-center justify-center mb-6",children:e.jsx(vt,{className:"w-10 h-10 text-neon-iris"})}),e.jsx("h3",{className:"text-xl sm:text-2xl font-semibold text-white mb-3",children:"Keys Required"}),e.jsxs("p",{className:"text-gray-400 mb-8 text-sm sm:text-base leading-relaxed",children:["You need at least ",(t==null?void 0:t.required_keys_to_follow)||1," ","key(s) to view this trader's trades. You currently have"," ",e.jsx("span",{className:"text-white font-medium",children:b.toFixed(2)})," ","key(s)."]}),Y!==null&&e.jsxs("div",{className:"bg-graphite-deep rounded-xl p-6 sm:p-8 w-full max-w-md border border-white/10 shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 pb-6 border-b border-white/5",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-moon-grey-dark uppercase tracking-wider mb-1",children:"Current Price"}),e.jsxs("p",{className:"text-2xl sm:text-3xl font-bold text-white tabular-nums",children:["$",Y.toFixed(4)]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-moon-grey-dark uppercase tracking-wider mb-1",children:"Supply"}),e.jsx("p",{className:"text-xl font-semibold text-white tabular-nums",children:t.keys_supply||0})]})]}),e.jsxs("div",{className:"flex gap-2 mb-6",children:[e.jsx("button",{onClick:()=>g(Math.max(1,u-1)),className:"px-4 py-2.5 bg-white/10 hover:bg-white/20 rounded-lg text-white transition-colors font-medium min-w-[48px]",children:"âˆ’"}),e.jsx("input",{type:"number",min:"1",value:u,onChange:r=>g(Math.max(1,parseInt(r.target.value)||1)),className:"flex-1 px-4 py-2.5 bg-white/5 border border-white/10 rounded-lg text-white text-center focus:outline-none focus:ring-2 focus:ring-neon-iris/50 focus:border-neon-iris font-medium"}),e.jsx("button",{onClick:()=>g(u+1),className:"px-4 py-2.5 bg-white/10 hover:bg-white/20 rounded-lg text-white transition-colors font-medium min-w-[48px]",children:"+"})]}),e.jsx("button",{onClick:Fe,disabled:$||a,className:"w-full py-3.5 bg-neon-iris hover:bg-neon-iris-light text-white font-semibold rounded-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 shadow-lg shadow-neon-iris/20",children:$?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Purchasing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"w-4 h-4"}),"Buy ",u," Key",u!==1?"s":""]})}),e.jsxs("div",{className:"mt-5 pt-5 border-t border-white/5 text-center space-y-1.5",children:[b>0&&e.jsxs("p",{className:"text-sm text-gray-400",children:["You own"," ",e.jsx("span",{className:"text-white font-medium",children:b.toFixed(2)})," ","key",b!==1?"s":""]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[(t==null?void 0:t.required_keys_to_follow)||1," key",((t==null?void 0:t.required_keys_to_follow)||1)>1?"s":""," ","required to follow"]})]})]})]})}):N?e.jsx("div",{className:"border-t border-white/10",children:Array.from({length:5}).map((r,i)=>e.jsx("div",{className:"px-4 py-3 border-b border-white/5 animate-pulse",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-white/10 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-4 w-24 bg-white/10 rounded"}),e.jsx("div",{className:"h-4 w-full bg-white/10 rounded"}),e.jsx("div",{className:"h-3 w-32 bg-white/10 rounded"})]})]})},i))}):_.length===0?e.jsx("div",{className:"border-t border-white/10 py-16",children:e.jsx(ce,{icon:ke,title:"No trades yet",subtitle:C?"Start trading to see your activity here":"This user hasn't made any trades yet"})}):e.jsx("div",{className:"border-t border-white/10",children:_.map((r,i)=>e.jsx("div",{style:{animationDelay:`${i*.05}s`},className:"animate-fade-in-up",children:e.jsx(Yt,{trade:r})},r.id))})})]})]}),e.jsx(St,{isOpen:we!==null,onClose:()=>le(null),imageUrl:we||"",alt:"Image"}),t&&e.jsx(qt,{isOpen:X,onClose:()=>I(!1),traderName:t.display_name||t.username||"Trader",currentSupply:t.keys_supply||1,currentPrice:Y||0,keyOwnership:b,isTrader:C,requiredKeysToFollow:t.required_keys_to_follow||1,onBuy:async r=>{const i=await _e({trader_id:t.id,quantity:r});if(y.success(`Successfully purchased ${i.quantity} key(s)`),await Z(),b===0&&i.quantity>=1&&!w)try{await de(t.id),K(!0),await oe()}catch(c){console.error("Auto-follow failed:",c)}},onSell:async r=>{const i=await Qe({trader_id:t.id,quantity:r});y.success(`Successfully sold ${i.quantity} key(s)`),await Z()}})]}):e.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center px-4",children:[e.jsx("span",{className:"text-6xl mb-4",children:"ðŸ‘»"}),e.jsx("h1",{className:"text-2xl font-bold text-white mb-2",children:"User not found"}),e.jsx("p",{className:"text-gray-400 mb-6",children:"This profile doesn't exist or has been removed"}),e.jsx("button",{onClick:()=>x(-1),className:"px-6 py-2.5 rounded-full bg-white/10 text-white font-medium hover:bg-white/20 transition-all",children:"Go back"})]})};export{It as UserProfile};
